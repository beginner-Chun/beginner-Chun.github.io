<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>MySQL笔记 | ifChun</title><meta name="keywords" content="java MySQL"><meta name="author" content="Huang_Chun"><meta name="copyright" content="Huang_Chun"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="MySQL笔记"><meta name="application-name" content="MySQL笔记"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="MySQL笔记"><meta property="og:url" content="https://www.dachun.icu/2024/05/09/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87/index.html"><meta property="og:site_name" content="ifChun"><meta property="og:description" content="基础用命令行窗口连接MySQL数据库1234mysql  -h 主机名  -p 端 -u 用户名 -p 密码# 登陆前保证服务启动net stop mysqlnet start mysql  使用指令创建数据库1234create database 数据库名 #使用指令创建数据库drop datab"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://chunimages.oss-cn-guangzhou.aliyuncs.com/2dc42d55705adecafceb5d9185d148df.jpeg"><meta property="article:author" content="Huang_Chun"><meta property="article:tag" content="java"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://chunimages.oss-cn-guangzhou.aliyuncs.com/2dc42d55705adecafceb5d9185d148df.jpeg"><meta name="description" content="基础用命令行窗口连接MySQL数据库1234mysql  -h 主机名  -p 端 -u 用户名 -p 密码# 登陆前保证服务启动net stop mysqlnet start mysql  使用指令创建数据库1234create database 数据库名 #使用指令创建数据库drop datab"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://www.dachun.icu/2024/05/09/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 你要不再看看？","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":true,"limitCount":50,"languages":{"author":"作者: Huang_Chun","link":"链接: ","source":"来源: ifChun","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'ifChun',
  title: 'MySQL笔记',
  postAI: '',
  pageFillDescription: '基础, 用命令行窗口连接MySQL数据库, 使用指令创建数据库, 数据库备份恢复操作, 数据类型, 表操作, 在where子句中经常使用的运算符, 字符串数据类型, 时间日期相关函数, 数学相关函数, 加密和系统函数, 流程控制函数, 分页查询, 连接, 自连接, 左外连接, 右外连接, 约束, 事务, 事务的四大特性（ACID）, 并发事务问题, 事务隔离级别, 存储引擎, 存储引擎特点, 存储引擎选择, 索引, 索引概述, 索引结构, 索引分类, 索引语法, SQL性能分析, 索引使用原则, 索引设计原则, SQL优化, 插入数据优化, insert优化, 大批量插入数据, 主键优化, order by 优化, group by优化, limit 优化, count 优化, update优化, 视图, 介绍, 检查选项, 视图的更新, 视图的作用, 存储过程, 介绍, 基本语法, 变量, 流程控制语句, 存储函数, 触发器, 介绍, 语法, 锁, 介绍, 全局锁, 表级锁, 表锁, 元数据锁(meta data lockMDL), 意向锁, 行级锁, 行锁, 间隙锁x2F临键锁, InnoDB引擎, 逻辑存储结构, 架构, 事务原理, MVCC, 实现原理, MySQL管理, 系统数据库, 常用工具, 日志, 错误日志, 二级制日志, 查询日志, 慢查询日志, 主从复制, 概述, 原理, 搭建, 分库分表, 介绍, 拆分策略, MyCat, 介绍, 入门, 配置, 分片, 分片规则, MyCat管理, MyCat监控, 读写分离, 介绍, 一主一从读写分离, 双主双从, 双主双从读写分离基础用命令行窗口连接数据库主机名端用户名密码登陆前保证服务启动使用指令创建数据库数据库名使用指令创建数据库数据库名使用指令删除数据库创建一个使用字符集的数据库数据库名数据库备份恢复操作显示数据库语句显示接口创建语句数据库名备份数据库在执行用户名密码数据库数据库文件名恢复数据库文件名备份库的表用户名密码数据库表表文件名数据类型长度为的字符型最大长度为的变长字符型长度为的数字型长整型短整型大整型精度至少为位数字的浮点数日期格式为时间格式为表操作创建表表名字符集添加数据表名查询表表名添加列表名修改列表名删除列表名查看表的结构表名修改表名表名新表名修改表字符集表名字符集语句表名表名形式添加多条记录如果是给表中的所有字段添加数据可以不写前面的字段名称默认值的使用当不给某个字段值时如果有默认值就会添加默认值语句表名列名条件语法可以用新值更新原有表行中的各列子句指示要修改哪些行和要给予哪些值子句指定更新哪些行如果没有子句则更新所有的行如果需要修改多个字段可以通过字段名值字段名值语句表名如果不适用子句将删除表中所有数据语句不能删除某一列的值可以使用设为或者使用语句仅删除记录不删除表本身如要删除表使用语句表名语句一般格式目标列表达式要显示的属性列表名视图名查询的对象条件表达式查询条件列名条件表达式查询结果分组列名次序最终查询结果排序表达式表名语句中可以使用语句列名别名表名在子句中经常使用的运算符比较运算符显示在某一区间的值显示在列表中的值模糊查询表示到多个任意字符表示单个任意字符判断是否为空逻辑运算符多个条件同时成立多个条件任一成立不成立使用子句排序查询结果表名列名指定排序的列排序的列既可以是表中的列名也可以是语句后指定列名别名升序默认降序子句应位于语句的结尾子句用于将结果集按照一个或多个列进行分组它通常和聚合函数如等一起使用以便对每个组应用聚合函数根据列对表进行分组并计算每个部门的员工数量子句用于过滤分组后的结果它类似于子句但是可以在分组后应用条件在的例子中我们只选择具有超过名员工的部门在中没有关键字不过在一些数据库系统中如可以使用来限制返回的行数这条语句将返回表中的前行记录字符串数据类型字符串的基本使用固定长度字符串最大个字符可变长度字符串最大字节编码最大字符个字节用于记录大小如果数据是定长使用比如密码邮编手机号如果数据一个字段是不确定使用比如文章查询速度返回字符串字符集连接字符串将多个列拼接成一列返回在中出现的位置没有返回转换成大写转换成小写从中的左边起取个字符与相反长度按照字节计算在中替换成逐字符比较两个字符串大小从的开始取个字符去除前端或者后端空格去除左右两端空格时间日期相关函数当前日期当前时间当前时间戳返回的日期部分当前时间数学相关函数绝对值十进制转换成二进制向上取整得到比大的最小整数进制进制直接转换向下取整得到比小的最大整数保留小数位保留小数位四舍五入求最小值求余返回随机值加密和系统函数查询用户查询当前使用的数据库名称为字符串算出一个的字符串常用于用户密码加密加密函数流程控制函数如果为则返回否则返回如果不为空则返回否则返回类似多重分支如果为则返回如果为返回否则返回分页查询表示行开始取取出行从开始计算每页显示记录数第几页每页显示记录数连接自连接把同一张表当做两张表使用需要给表取别名表名表别名列名不明确可以指定列的别名列名新列名左外连接左侧的表完全显示表表条件右外连接右侧的表完全显示表表条件约束主键用于唯一标识表行的数据当定义主键约束后该列的值不能重复细节不能重复而且不能为一张表最多只能有一个主键但可以是复合主键直接在字段名后指定字段名在表定义最后写列名唯一定义当定义了唯一约束后该列值不能重复语法格式字段名字段类型细节如果没有指定则字段可以有多个一张表可以有多个外键用于定义主表和从表之间的关系外键约束要定义在从表上主表则必须具有主键约束或者是约束当定义外键约束后要求外键列数据必须在主表的主键列存在或者是为本表字段名主表名主键名或者是字段名外键指向的表的字段要求是或者是表的类型是这样的表才支持外键外键的字段的类型要求和主键字段的类型一致长度可以不同外键的字段值必须在主键字段中出现过工作为前提是外键字段允许为一旦建立外键关系数据不能随意删除自增长字段名整形一般来说自增长是和配合使用的自增长也可以单独使用但需要配合一个自增长修饰的字段为整数型的自增长默认从开始可用通过命令修改表名新值如果添加数据是给自增长字段指定值时以指定值为准事务定义事务用于保证数据的一致性它有一组相关的语句组成该组语句要么全部成功要么全部失败事务和锁当执行事务操作会在表上加锁防止其他用户修改表的数据数据库控制台事务的几个重要操作开始一个事务中为保存点名设置一个保存点中为保存点名保存点名回退事务回退全部事务提交事务所有的操作生效不能回退提交事务使用语句可以提交事务当执行了语句后会确认事务的变化结束事务删除保存点释放锁数据生效当使用语句后结束无所谓其他会话将可以查看到事务变化后的新数据细节如果不开始事务默认情况下操作是自动提交的不能回滚如果开始一个事务但没有创建保存点可以执行默认回退到开始的状态可以在事务没有提交前选择回退哪个保存点存储引擎支持事务不支持开始一个事务事务隔离级别事务的四大特性原子性事务是不可分割的最小操作单元要么全部成功要么全部失败一致性事务完成时必须使所有的数据都保存一致状态隔离性数据库系统的隔离机制保证事务在不受外部并发操作影响的独立环境下运行持久性事务一旦提交或回滚它对数据库中的数据的改变是永久的并发事务问题脏读一个事务读到另外一个事务还没有提交的数据事务读取到事务还没提交的事务会产生数据的不一致不可重复读一个事务先后读取同一条记录但两次读取的数据不同称为不可重复读事务的第一次读取和第二次读取的数据不一致因为在两次执行的间隙中事务执行完成修改了数据幻读一个事务按照条件查询数据时没有对应的数据行但是在插入数据时有发现这行数据已经存在好像出现了幻影当事务查询时没有查询到因为数据库不存在该数据此时事务插入的数据并提交事务接着事务也想插入的数据但是不能插入因为为主键不能重复这时事务想查询的数据不能查询因为是可重复读了需要事务也提交事务才能查询事务隔离级别查询事务隔离级别设置事务管理级别一次只能执行一个事务当事务提交后才能执行事务注意事务隔离级别越高数据越安全但是性能越低存储引擎体系结构简介存储引擎就是存储数据建立索引更新查询数据等技术的实现方式存储引擎是基于表的而不是基于库的所以存储引擎也可被称为表类型存储引擎没有好坏之分在适当场景下使用不同的存储引擎各个存储引擎各有优劣势查看所有引擎表名字段字段类型字段字段类型存储引擎名存储引擎特点介绍是一种兼顾高可靠性和高性能的通用存储引擎在之后是默认的存储引擎特点数据的增删改操作遵循模型支持事务行级锁提高并发访问性能支持外键约束保证数据的完整性和正确性文件代表的是表名引擎的每张表都会对应这样一个表空间文件存储该表的表结构数据和索引参数逻辑存储结构介绍是早期使用的存储引擎特点添加速度快不支持外键和事务支持表级锁不支持行锁文件存储表结构信息存储数据存储索引介绍引擎的表数据时存储在内存中由于受到硬件问题或断电问题的影响只能将这些表作为临时表或缓存使用特点数据存储在内存中执行速度快没有读写默认支持索引表文件存储表结构信息存储引擎选择在选择存储引擎时应该根据应用系统的特点选择合适的存储引擎对于复杂的应用系统还可以根据实际情况选择多种存储引擎进行组合绝大数业务场景使用存储是的默认存储引擎支持事务外键如果应用对事务的完整性有比较高的要求在并发条件下引擎数据的一致性数据操作除了插入和查询之外还包含很多的更新删除操作那么存储引擎是比较合适的选择如果应用时以读操作和插入操作为主只有很少的更新和删除操作并且对事物的完整性并发性要求不高那么选择这个存储索引是非常合适的已被取代将所有数据保存在内存中访问速度快通常用于临时表以及缓存的缺陷就是对表的大小有限制太大的表无法缓存在内存中而且无法保证数据的安全性存储引擎添加速度快不支持外键和事务支持表级锁存储引擎支持事务和外键支持行级锁存储引擎数据存储在内存中执行速度快没有读写默认支持索引表如何选择表的存储引擎如果应用不需要事务处理的知识基本的操作那么是不二选择速度快如果需要支持事务选择修改存储引擎表名索引索引概述介绍索引是帮助高效获取数据的数据结构有序在数据之外数据库系统还维护着满足特定查找算法的数据结构这些数据结构以某种方式引用指向数据这样就可以在这些数据结构实现国际查找算法这种数据结构就是索引演示优势提高数据检索的效率降低数据库的成本通过索引列对数据进行排序降低数据排序的成本降低的消耗劣势索引列需要占用空间可以忽略不计索引订单提高了查询效率同时也降低更新表的速度如对表继续效率降低但是在一个业务系统增删改的操作较少可以忽略索引结构的索引是在存储引擎层实现的不同存储引擎有不同的结构主要包含以下几种如果没有特别指定都是指树结构组织的索引多路平衡查找树以一棵最大度数为的为例每个节点最多存储四个个指针以一棵最大度数为的为例阶的为例相对于区别所有的数据都会出现在叶子节点叶子节点形成一个双向链表索引数据结构对经典的进行了优化在原的基础上增加了指向相邻叶子节点的链表指针就形成了带有顺序指针的提高期间访问的性能哈希索引就是采用一点的算法将键值换算成新的值映射到对应的槽位上然后存储在表中如果两个或多个键值映射到一个相同的槽位上它们就产生了冲突也称为碰撞可以通过链表来解决特点索引只能用于对等比较不支持范围查询无法利用索引完成排序操作查询效率高通常只需要一次索引不产生冲突就可以了效率通常要高于索引思考为什么存储引擎选择使用索引结构答相对于二叉树层级更少搜索效率高对于无论是叶子节点还是非叶子节点都会保存数据这样导致一页中存储的键值减少指针跟着减少要同样保存大量数据只能增加数的高度导致性能降低相对索引支持范围匹配及排序操作双向循环链表索引分类在存储引擎中根据索引的存储形式又可以分为以下两种聚集索引选取规则如果存在主键主键索引就是聚集索引如果不支持主键将使用第一个唯一索引作为聚集索引如果没有主键或没有合适的唯一索引则会自动生成一个作为隐藏的聚集索引的执行流程思考以下语句哪个执行效率高为什么答根据查询的效率更高根据查询直接根据聚集索引查询即可根据查询需要使用的二级索引查询到值再回表查询走聚集索引查询主键索引的高度为多高假设一行数据大小为一页中可以存储行这样的数据的指针占用个字节的空间主键即使为占用字节数为每页大小为高度为得出约为条数据高度为条数据索引语法创建索引索引名表名字段名查看索引表名删除索引索引名表名性能分析执行频率客户端连接成功后通过命令提供服务器状态信息通过如下指令可以查看当前数据库的的访问频次七个慢查询日志慢查询日志记录了所有执行时间超过指定参数单位秒默认秒的所有的语句的日志的慢查询日志默认没有开启需要在的配置文件中配置如下信息查询慢查询日志配置完毕之后重启服务器查看慢查询日志的记录信息详情能够在做优化是帮助我们连接时间都消耗到哪里了通过参数能够看到当前是否支持操作默认是关闭的可以同语句在级别开启执行一系列的业务的操作然后通过如下指令查看指令的执行耗时执行计划或命令获取如何执行语句的信息包括语句执行过程中表如何连接和连接的顺序语法表名条件执行聚合个字段含义查询的序列号表示查询中执行子句或者是操作表的顺序相同执行顺序从上到下不同值越大执行越优先表示的类型创建的取值有简单表主程序即外层的查询中第二个或者后面的查询语句之后包含了子查询等表示连接类型性能由好到差的连接类型为全表扫描性能低显示可能应用在这张表上的索引一个或多个实际使用的索引如果为则没有使用索引表示索引中使用字节数该值为索引字段最大可能长度并非实际使用长度在不损失精确性的前提下长度越短越好认为必须要执行的行数在引擎的表中是一个预估值可能并不总是准确表示返回结果的行数占需要读取的行数的百分比的值越大越好索引使用原则最左前缀法则如果索引了多列联合索引要遵守最左前缀法则最左前缀否则指的是查询从索引的最左列开始并且不跳过索引中列如果跳跃某一列索引将部分失效后面的字段索引失效与查询字段的位置无关字段存在即可范围查询联合索引中出现范围查询范围查询右侧的列索引失效索引列运算不可在索引列上进行运算操作索引将失效字符串不加引号字符串类型字段使用时不加引号索引将失效字符和日期类型数据应包含在单引号中模糊查询如果解决是尾部模糊匹配索引不会失效如果是头部模糊匹配索引失效连接的条件用分隔开的条件如果前的条件中的列有索引而后面的列中没有索引那么涉及的索引都不会被用到由于没有索引所以即使有索引索引也会失效所以需要针对于也要建立索引数据分布影响如果评估使用索引比全表扫描更慢则不使用索引提示提示是优化数据库的一个主要手段简单来说就是在语句中加入一些人为的提示来达到优化操作的目的覆盖索引尽量使用覆盖索引查询使用率索引并且需要返回的列在该索引中已经全部能够找到减少查找使用率索引但是需要回表查询数据查找使用了索引但是需要的数据都在索引列中能找到所以不需要回表查询数据前缀索引当字段类型为字符串等是有时候需要索引很长的字符串这会让索引变得很大查询时浪费大量的磁盘影响查询效率此时可以只将字符串的一部分前缀建立索引这样可以大大节约索引空间从而提高索引效率表示截取的长度前缀长度可以根据索引的选择性来决定就二选择性是只不重复的索引值基数和数据表的记录总数的比值索引选择性越高则查询效率越高唯一索引的选择性是这是最好的索引选择性性能也是最好的选择性求法单列索引与联合索引单列索引即一个索引值包含单个字段联合索引即一个索引值包含多个字段在业务场景中如果存在多个查询条件考虑针对于字段建立索引是建议建立联合索引而非单列索引多条件联合查询时优化器会评估哪个字段的索引效率更高会选择该索引完成本次查询联合索引情况索引设计原则针对于数据量较大且查询比较频繁的表建立索引十万级别的数据针对于常作为查询条件排序分组操作的字段建立索引尽量选择区分度高的列作为索引尽量建立唯一索引区分度越高使用索引的效率越高如果是字符串的字段字段的长度较长可以针对于字段的特点建立前缀索引尽量使用联合索引减少单列索引查询是联合索引很多时候一覆盖索引节省存储空间避免回表查询提高查询效率需要遵循最左前缀法要控制索引的数量索引并不是多多益善索引越多维护索引结构的代价越大会影响增删改的效率如果索引列不能存储值需要在创建表时使用约束他当优化器知道每列是否包含值时它可以更好地确定哪个索引最有效地用于查询索引名表名字段名索引类型外键索引主键自动为主索引唯一索引普通索引全文索引索引增删改查查询索引表名删除索引索引名表名修改索引先删除再添加新的索引小结比较频繁的作为查询条件的字段应创建索引更新非常频繁的字段不适合创建索引编号出现在子句中的字段不创建索引优化插入数据优化优化批量插入一次插入到条比较合适如果数据大则分多条插入手动提交事务主键顺序插入大批量插入数据如果一次性需要插入大批量数据使用语句插入性能较低此时可以使用数据库提供的指令进行插入客户端连接服务端是加上参数设置全局程序为开启从本地加载文件导入数据的开关执行指令将准备好的数据加载到表结构中表名解析字段将以分割每行数据以分隔主键顺序插入性能高于乱序插入主键优化数据组织方式在存储引擎中表数据都是根据主键顺序组织存放的这种存储方式的表成为索引组织表页分裂页可以为空也可以填充一半也可以填充每个页包含了行数据如果一行数据较大会行溢出根据主键排列主键乱序插入会产生页分裂的情况页合并当删除一行记录是实际上记录并没有被物理输出只是记录被标记为删除并且它的空间变得允许被其他记录声明使用当页中删除的记录达到合并页的阈值默认为页的会开始寻找最靠近的页前或后看看是否可以将两个页合并以优化空间使用主键的设计原则满足因为需求的情况下尽量降低主键的长度插入数据时尽量选择顺序插入选择使用使用自增主键尽量不要使用做主键或是其他自然主键如身份证号因为操作是避免对主键的修改优化通过表的索引或全表扫描读取满足条件的数据行然后在排序缓冲区中完成排序操作所有表示同索引直接返回排序结果的排序都叫排序通过有序索引顺序扫描直接返回有序数据这种情况即为不需要额外排序操作效率高总结根据排序字段建立合适的索引多字段排序时页遵循最左前缀否则尽量使用覆盖索引多字段排序一个升序一个降序此时需要注意联合索引在创建时的规则如果不可避免的出现大数据量排序是可以适当增大排序缓冲区大小默认如果空间满了则会在磁盘文件进行排序性能低优化在分组操作是可以使用索引来提高效率分组操作是索引的使用也是要满足最左前缀法则的优化一个常见问题就是此时需要排序前条记录仅仅返回的记录其他记录丢弃查询排序的代价非常大优化思路一般分页查询时通过超级爱你覆盖索引能够比较好低提高性能可以通过覆盖索引加子查询形式进行优化如下通过覆盖索引的得到的一个仅有的表再通过子查询的形式查询优化引擎把一个表的的总行数存在了磁盘上因此的时候会直接返回这个数效率很高引擎在执行的时候需要把数据一行一行地从引擎中读取出来如果累积计数优化思路自己计数数据的插入和删除时分别计数比较繁琐的几种用法是一个聚合函数对于返回的结果集一行行地判断如果函数的参数不是累积值加一否则不加最后返回累计值用法主键字段主键引擎会遍历整张表把每一行的主键值都取出来返回给服务层服务层拿到主键后直接按行进行累加主键不可能为字段没有约束引擎会遍历整张表把每一行字段都取出来返回给服务层服务层判断是否为不为计数累加有约束引擎会变量整张表把每一行字段都取出来返回给服务层直接进行累加引擎遍历整张表但是不取值服务层对于返回的每一行放一个数据进去直接按行进行累加引擎并不会把全部字段取出来而是专门做了优化不取值服务层直接按行进行累加按照效率排序的话字段主键索引尽量使用优化的行锁是针对索引加的锁不是针对记录加的锁并且该索引不能失效否则会从行锁升级为表锁如果不是索引则引擎会将整张表锁住其他事务不能对该表的数据进行修改视图介绍视图是一种虚拟存在的表视图中的数据并不在数据库中实际操作行和列数据来自定义视图的程序中使用的表并且是在使用视图时动态生成的通俗的将视图子保存了查询的逻辑不保存查询的结果所以在创建视图的时候主要工作就落在创建这条查询语句上创建视图视图名称列名列表语句查询创建视图语句视图名称修改方式一视图名称列名列表语句方式二视图名语句删除视图名检查选项当使用子句创建视图时会通过视图检查正在更改的每个行例如插入更新删除以使其符合视图的定义允许基于另一个视图创建视图它还会检查依赖视图中的规则以保持一致性为了确定检查的范围提供了两个选项和默认值为级联只将自身进行捆绑检查自身数据不会强制依赖的视图进行检查若依赖的视图有检查选项就检查反之不检查视图的更新要是视图可更新视图中的行与基础表中的行之间必须存在一对一的关系如果视图包含以下任何影响则该视图不可更新聚合函数或窗口函数等或者视图的作用操作简单视图不仅可以简化用户对数据的理解也可以简化它们的操作那些被经常使用的程序可以被定义为视图从而使得用户不必为以后的操作每次指定全部的条件安全数据库可以授权但不能授权到数据库特定行和特点的列上通过视图用户只能查询和修改它们所能见到的数据数据独立视图可帮助用户屏蔽真实表结构变化带来的影响定义视图是一个虚拟表其内容头查询定义同真实的表一样视图包含列其时间来自对应的真实表对视图的总结视图是根据基表来创建的视图是虚拟的表视图也有列数据来自基表通过视图可以修改基表的数据基表的改变也会影响视图的数据视图的基本使用视图名语句表名视图名语句表名视图名视图视图注意视图中可以再使用视图存储过程介绍存储过程是事先经过编译并存储在数据库中一段语句的集合调用存储过程可以简化应用开发人员的很多工作减少数据在数据库和应用服务器之间的传输对于提高数据处理的效率是有好处的存储过程思想上就是数据库语言层面的代码封装与重用特点封装复用可以接收参数也可以返回数据减少网络交互效率提升基本语法创建存储过程名称参数列表语句在命令行中执行创建存储过程的是需要通过关键字指定语句的结束符调用存储过程名参数查看查询指定数据库的存储过程及状态信息数据库名称查询某个存储过程的定义存储过程名称删除存储过程名称变量系统变量系统变量是服务器提供不是用户定义的属于服务器层面分为全局变量会话变量查看系统变量查看所有系统变量通过模糊匹配方式查找变量系统变量名查看指定变量的值设置系统变量系统变量名值系统变量名值注意如果没有指定默认是会话变量访问重新启动之后所设置的全局参数会失效要想不失效可以在中配置自定义变量用户定义变量是永恒更具需要自己定义的变量用户变量不用提取声明在用的时候直接用变量名使用就可以其作用域为当前连接赋值字段名表名使用注意用户定义的变量无需对其进行声明或初始化只不过获取到的值为局部变量局部变量是根据需要定义的在局部生效的变量访问之前需要声明可用做存储过程内的局部变量和输入参数局部变量的范围是在其内声明的块声明变量名变量类型赋值变量名值变量名值字段名变量名表名流程控制语句语句语法条件条件参数语法存储过程名称参数名参数类型语句优秀及格不及格语法语法查询条件查询条件第一季度第二季度第三季度第四季度循环是有条件的循环控制语句满足条件后再执行循环体中语句条件逻辑累积到是有条件的循环控制语句当满足条件的时候退出循环逻辑条件实现简单的循环如果不在逻辑中添加退出循环的条件可以用其来实现简单的死循环可以配合以下两个语句使用配合循环使用过退出循环必须用在循环中其作用是跳过当前循环剩下的语句直接进入下一次循环逻辑累加之间的偶数游标游标是用来存储存储程序结果集的数据类型在存储过程和函数中可以使用游标对结果集进行循环的处理游标的使用包括游标的声明和声明游标游标名称查询语句打开游标游标名称获取游标记录游标名称变量变量关闭游标游标名称条件处理程序条件处理程序可以用来定义在流程控制结构执行过程中遇到问题是相应的处理步骤当游标中的数据为空时关闭游标并退出名称存储函数存储函数是有返回值的存储过程存储函数的参数只能是类型计算从累加到的值为传入的参数值触发器介绍触发器是与表有关的数据库对象值在之前或之后重复并执行触发器中定义的语句集合触发器的这种特性可以协助应用在数据库端确保数据的完整性日志记录数据校验等操作使用别名和来引用触发器中发生变化的记录内容这与其他的数据库是相似的现在触发器还只支持行级触发不支持语句级触发语法创建行级触发器逻辑查看删除如果没有指定默认为当前数据库添加数据的触发器修改数据的触发器删除数据的触发器锁介绍锁是计算机协调多个进程或线程并发访问某一资源的机制在数据库中除传统的计算资源的争用以外数据也是一种供许多用户共享的资源然后保证数据并发访问的一致性有效性是所有数据库必须解决的一个问题锁冲突也是影响数据库并发访问性能的一个重要因素分类中的锁按照锁的粒度分分为三类全局锁锁定数据库中的所有表表级锁每次操作锁住整张表行级锁每次操作锁住对应的行数据全局锁全局锁就是对整个数据库实例加锁加锁后整个实例处于只读状态后续的的写语句语句已经更新操作的事务提交语句都将被阻塞其典型的使用场景就是做全库的逻辑备份对所有的表进行锁定从而获取一致性视图保证数据的完整性加锁前加锁后添加全局锁备份数据数据库名解除锁特点数据库中加全局锁是一个比较重的操作存在以下问题如果在主库上备份那么在备份期间都不能执行更新业务基本上就得停摆如果在从库上备份那么在备份期间从库不能执行主库同步管理的二进制日志会导致主从延迟在引擎中我们可以在备份时加上参数参数来完成不加锁的一致性数据备份数据库名表级锁表级锁每次操作锁住整张表锁定粒度大发生锁冲突的概率最高并发度最低应用在等存储引擎中对于表级锁主要分为以下三类表锁元数据锁意向锁表锁表共享读锁表独享锁语法加锁表名释放锁客户端断开连接读锁不会阻塞其他客户端的读但是会阻塞写写锁既会阻塞其他客户端的读又会阻塞其他客户端的写元数据锁加锁过程是系统自动控制无需显示使用在访问一张表的时候会自动加上锁主要作用是维护元数据的数据一致性在表上有活动事务的时候不可以对元数据进行写入操作为了避免数据定义语言与数据操作语言冲突保证读写的正确性在中引入了当对一张表进行增删改查的时候加读锁共享当对表结构进行变更操作的时候加写锁排他查看元数据锁意向锁为了避免在执行时加的行锁与表锁的冲突在中引入了意向锁使得表锁不用检查每一行数据是否加锁使用意向锁来减少表锁的检查意向共享锁由语句添加与表锁共享锁兼容与表锁排他锁互斥意向排他锁由添加与表锁共享锁及排它锁都互斥意向锁之间不会互斥查看意向锁机行锁的加锁情况行级锁行级锁每次操作锁住对应的行数据锁定粒度最小发生锁冲突的概率最低并发度最高应用在存储引擎中的数据是基于索引组织的行锁时通过对索引上的索引项加锁来实现的而不是对记录加的锁对于行级锁主要分为以下三类行锁锁定单个行记录的锁防止其他事务对此进行和在隔离级别下都支持间隙锁锁定索引记录间隙不含该记录确保索引记录间隙不变赋值其他事务在这个间隙进行产生幻读在隔离级别下都支持临键锁行锁和间隙锁组合同时锁住数据并锁住数据前面的间隙在隔离级别下支持行锁实现了两种类型的行锁共享锁允许一个事务去读一行阻止其他事务获得相同的数据集的排它锁排它锁允许获取排它锁的事务更新数据阻止其他事务获得相同数据记得共享锁和排它锁默认情况下在事务隔离级别运行使用锁进行搜索和索引扫描以防止幻读针对唯一索引进行检索式对已存在的记录进行等值匹配时将会自动优化为行锁的行锁是针对于索引加的锁不通过索引条件检索数据那么将对表中的所有记录加锁此时就会升级为表锁查看意向锁机行锁的加锁情况间隙锁临键锁默认情况下在事务隔离级别运行使用锁进行搜索和索引扫描以防止幻读索引上的等值查询唯一索引给不存在的记录加锁时优化为间隙锁索引上等值查询普通索引向右遍历是最后一个值不满足查询需求时退化为间隙锁索引上的范围查询唯一索引会访问到不满足条件的第一个值为止注意间隙锁唯一的目的是防止其他事务插入间隙间隙锁可以共存一个事务采用的间隙锁不会阻止另一个事务在同一间隙上采用间隙锁引擎逻辑存储结构架构版本开始默认使用存储引擎它擅长事务处理具有恢复特性在日常开发中使用非常广泛下面是架构图左侧为内存结构右侧为磁盘结构内存架构缓冲池是主内存中一个区域里面可以缓存磁盘上进程操作的真实数据在执行增删改查操作是先操作缓冲池中的数据若缓冲池没有数据则从磁盘加载并缓存然后在意一定频率刷新到磁盘从而减少加快处理速度缓冲池以页为单位底层采用链表数据结构管理根据状态将分为三种类型空闲未被使用被使用数据没有被修改过脏页被使用数据被修改过而且数据域磁盘的数据产生了不一致更改缓冲区针对于非唯一二级索引页在执行语句是如果这些数据没有在中不会直接操作磁盘而会将数据变更操作更改缓冲区中在未来数据被读取时再将数据合并恢复到中再将合并后的数据刷新到磁盘中的意义是什么与聚集索引不同二级索引通常是非唯一的并且以相对随机的顺序插入二级索引同样删除和更新可能会影响索引树中不相邻的二级索引页如果每一次都操作磁盘会造成大量的磁盘有了之后我们可以在缓冲池中进行合并处理自适应索引用于优化对数据的查询存储引擎会监控对表上各索引页的查询如果观察到索引可以提升速度则建立索引称之为自适应索引自适应哈希索引无需人工干预是系统根据情况自动完成参数日志缓冲区用来保存要写入到磁盘中的日志数据默认大小为日志缓冲区的日志会定期刷新到磁盘中如果需要更新插入或删除许多行的事务增加日志缓冲区的大小可以节省磁盘参数缓冲区大小日志刷新到磁盘时机磁盘结构后台线程核心后台线程负责调度其他线程还负责将缓冲池的数据异步刷新到磁盘中保存数据的一致性还包括脏页的刷新合并插入缓存页的回收在存储引擎中大量使用了异步来处理请求这样可以极大地提高了数据库的性能而主要负责这些请求的回调主要用于回收事务已经提交了的在事务提交之后可能不用了就用它来回收协助刷新脏页到磁盘的线程它可以减轻的工作压力减少阻塞事务原理持久性重做日志记录的是事务提交时数据页的物理修改是用来实现事务的持久性该日志文件有两部分组成重做日志缓冲以及重做日志文件前者是在内存中后者在磁盘中当事务提交之后会把所有修改信息都存到改日志文件中用于在刷新脏页到磁盘发生错误事进行数据恢复使用原子性回滚日志用于记录数据被修改前的信息作用包含两个提供回滚和多版本并发控制和记录物理日志不一样它是逻辑日志可以认为当一条记录是中记录一条对应的记录反之亦然当一条记录是它记录一条对应相反的记录修改前的记录当执行是就可以从中的逻辑记录读取到相应的内容并进行回滚销毁在事务执行时产生事务提交时并不会立即删除因为这些日志可能回用于存储采用段的方式进行管理和记录存放在前面介绍的回滚段中内部包含个一致性锁隔离性当前读读取的是记录的最新版本读取是还要保证其他并发事务不能修改当前记录会对读取的记录进行加锁对于我们日常的操作如共享锁排它锁都是一种当前读快照读简单的不加锁就是快照读快照读读取的是记录数据的可见版本有可能是历史数据不加锁是非阻塞读每次都删除一个快照读开启事务后第一个语句才是快照读的地方快照读会退化为当前读全称多版本并发控制指维护一个数据的多个版本使得读写操作没有冲突快照读为实现提供了一个非阻塞读功能的具体实现还需要依赖于数据库三个组件记录中三个隐式字段版本链实现原理记录中的隐藏字段回滚日志在的时候产生的便于数据回滚的日志当的时候产生的日志只在回滚是需要在事务提交后可被逻辑删除而的时候产生的日志不仅在回滚是需要在快照读时也需要不会立即被删除版本链不同事务或相同事务对同一条记录进行修改会导致该记录的生成一条记录版本链表链表的头部是最新的就记录链表尾部是最早的旧记录读视图是快照读执行时提取数据的依据记录并维护系统当前活跃的事务为提交的中包含了四个核心字段不同的隔离级别生成的时机不同在事务中每一次执行快照读时生成仅在事务中第一次执行快照读生成后续复用该管理系统数据库数据库安装后自带了四个数据库常用工具该表示值服务而是指的客户端工具选项可以在客户端执行语句而不用连接到数据库再执行对于一些批处理脚本这种方式尤其方便是一个执行管理操作的客户端程序可以用它来检查服务器的配置和当前状态创建并删除数据库等由于服务器生成的二进制日志文件以二进制格式保存所以如果想要检查这些文本的文本格式就会使用到日志管理工具客户端对象查找工具用来很快查找存在哪些数据库数据库中表表中的列或索引客户端工具用来备份数据库或在不同数据库组件进行数据迁移备份内容包含创建表及插入表的语句备份库的表用户名密码数据库表表文件名是客户端数据导入工具用来导入加参数后导出的文本文件语法示例如果需要导入文件使用指令恢复数据库文件名创建用户用户名允许登录的位置密码声明创建用户的同时指定密码删除用户用户名允许登录位置用户修改密码修改自己的密码密码修改他人的密码用户名允许登录位置密码给用户授权基本语法权限列表库对象名用户名登录位置密码权限列表多个权限用逗号隔开特别声明代表本系统中所有数据库的所有对象表视图库表示某个数据库中的所有对象表视图可以省略可以写出如果用户存在就是修改用户密码如果用户不存在就是创建该用户回收用户授权基本语法权限列表库对象名用户名登录位置权限生效指令如何权限没有生效执行细节声明创建用户的时候如果不指定则为表示所有都有连接权限可以指定表示用户在的可以登录在删除用户的时候如果表示需要明确指定用户值日志错误日志错误日志是中最重要的日志之一它记录了当启动和停止时以及服务器在运行过程中发生任何严重错误事的相关信息当数据库出现任何故障导致无法正常使用时建议首先查看此日志该日志是默认开启的默认存放目录默认的日志文件名为查看日志位置二级制日志介绍二进制日志记录了所有的数据定义语言语句和数据操纵语言语句但不包含数据查询语句作用灾难时的数据恢复的主从复制在版本中默认二级制日志是开启着的日志格式服务器中提供了多种格式来记录二进制日志具体格式及特点如下日志查看由于日志是以二进制方式存储的不能直接读取需要通过二进制日志查询工具来查看日志删除对于比较繁忙的业务系统每天生成的数据巨大如果长时间不清除将会占用大量磁盘空间也可以在的配置文件中配置二进制的过期时间设置了之后二进制日志过期会自动删除查询日志查询日志中记录了客户端的所有操作语句而二进制日志不包含查询数据的语句默认情况下查询日志是未开启的如果需要开启查询日志修改的配置文件文件添加如下内容慢查询日志慢查询日志记录了所有执行时间超过参数设置值并且扫描数不小于的所有的语句的日志默认未开启默认为秒最小为精度可以到微秒默认情况下不会记录管理语句也不会记录不使用索引进行查找的查询可以使用和更改此行为主从复制概述主从复制时指将主数据库的和操作通过二进制日志传到从库服务器中然后在从库对这些日志重新执行也叫重做从而使得从库和主库的数据保存同步支持一台主库同时向多台从库进行复制从库同时也可以作为其他服务器的主库实现链状复制复制的优点主要包含以下三个方面主库出现问题可以快速切换到从库提供服务实现读写分离降低主库的访问压力增删改走主库查询走从库可以在从库中执行备份以避免备份期间影响主库服务原理的主从复制原理复制过程分成三步主库在事务提交时会把数据变更记录在二进制日志文件中从库读取主库的二进制日志文件写入到从库的中继日志重做中继日志中的事件将改变反映它自己的数据搭建服务器准备主库配置修改配置文件重启服务器登录创建远程连接账号并授予主从复制权限通过指令查看二进制日志坐标从库配置修改配置文件重启服务器登录设置主库配置版本版本以前开启同步操作之后之前查看主从同步状态之后之前测试分库分表介绍问题分析随着互联网及移动互联网的发展应用系统的数据量也是成指数式增长若采用单数据库进行数据存储存在以下性能瓶颈瓶颈热点数据太多数据库缓存不足产生大量磁盘效率较低请求数据太多带宽不够网络瓶颈瓶颈排序分组连接查询聚合统计等会耗费大量的资源请求数太多出现瓶颈分库分表的中心思想是将数据分散存储使得单一数据库表的数据量变小来缓解单一数据库的性能问题从而达到提升数据库性能的目的拆分策略垂直拆分垂直分库以表为依据根据业务将不同表拆分到不同库中特点每个库的表的结构都不一样每个库的数据干不也一样所有库的并集是全量数据垂直分表以字段为依据根据字段属性将不同字段拆分到不同表中特点每个表的结果都不一样每个表的数据也不一样一般通过一列主键外键关联所有表的并集是全量数据水平拆分水平分库以字段为依据按照一定策略将一个库的数据拆分到多个库中特点每个库的表结构都一样每个库的数据都不一样所有库的并集是全量数据水平分表以字段为依据按照一定策略将一个表的数据拆分到多个表中特点每个表的表结构都一样每个表的数据都不一样所有表的并集是全量数据实现技术基于原理在应用程序中对本地执行的进行拦截解析改写路由处理需要自行编码配置实现只支持语言性能较高数据库分库分表中间件不用调整代码即可实现分库分表支持多种语言性能不及前者介绍是开源的活跃的基于语言编写的数据库中间件可以向使用一样来使用对于开发人员来说根本感觉不到的存在优势性能可靠稳定强大的技术团队体系完善社区活跃下载目录结构概念介绍入门需求由于表中数据量很大磁盘及容量都到达率瓶颈现在需要对表记性数据分片分为三个数据节点每一个节点主机位于不同的服务器上具体结构如下环境准备分片配置目录下配置的用户级用户的权限信息启动服务切换到的安装目录执行指令启动停止启动后占用端口号为启动完毕之后可以查看目录下的启动日志查看是否启动完成连接并登录端口号密码配置作为的最重要的配置文件之一涵盖了的逻辑库逻辑表分片规则分片节点及数据源的配置主要包含以下三组标签标签标签用于定义实例中的逻辑库应该实例中可以有多个逻辑库可以通过标签来划分不同的逻辑库中逻辑库的概念等同于中的概念需要操作某个逻辑库下的表时也需要切换逻辑库标签定义了中逻辑库下的逻辑表所有需要拆分的表都需要的标签中定义标签标签中定义了中的数据节点也就是我们通常说的数据分片一个标签就是一个独立的数据分片标签该标签中逻辑库中作为底层标签存在直接定义了具体的数据库实例读写分离心跳语句中定义了所有拆分分表的规则在使用过程中可以灵活的使用分片算法或者对同一个分片算法使用不同的参数它让分片过程可配置化主要包含类标签配置文件包含了的系统配置信息主要有两个主要的标签标签标签分片垂直拆分场景在业务系统中涉及以下表结构但是由于用户与订单每天都会产生大量的数据单台服务器的数据存储及处理能力是有限的可以对数据库进行拆分原有的数据库表如下准备配置测试在的语句等同于在的语句全局表配置对于省市区表是属于数据字典表在多个业务模块中都可能会遇到可以将其设置为全局表利于业务操作水平拆分场景在业务系统中有一张表日志表业务系统每天都会产生大量的日志数据单台服务器的数据存储及处理能力是有限的可以对数据库表进行拆分准备配置测试在的命令行中执行如下创建表并插入数据查看数据分布情况分片规则范围分片根据指定的字段及其配置的范围与数据节点的对应情况来决定该数据属于哪一个分片需要自定义时修改文件的规则即可取模分片根据指定的字段与节点数量进行求模运算根据运算结果来决定该数据属于哪一个分片一致性一致性哈希相同的哈希因子计算值总是被划分到相同分区表中不会业务分区节点的增加而改变原来的数据的分区位置枚举分片通过在配置文件中配置可能的枚举值指定数据分布到不同数据节点上本规则适用于按照省份性别状态拆分数据等业务应用指定分片运行阶段由应用自主决定路由到那个分片直接更具字符子串必须是数字计算分片号固定分片算法该算法类似于十进制的求模运算但是为二级制的操作例如取的二进制低位与进行位运算字符串解析截取字符串中的指定位置的子字符串进行算法算出分片按天日期分片按自然月分片使用场景为按照月份来分片每个自然月为一个分片管理原理默认卡通个端口可以在中进行修改数据访问端口即进行和操作数据库管理端口即服务管理控制功能用于管理的整个集群状态监控是对提供监控服务功能不局限于对使用它通过连接对监控监控远程服务器目前仅限于系统的内存网络磁盘运行过程中需要依赖因此需要先安装安装安装安装配置开启的实时统计功能为开启关闭在监控界面配置服务地址读写分离介绍读写分离简单地说是把对数据库的读和写操作分开以对应不同的数据库服务器主数据库提供写操作从数据库提供读操作这样能有效地减轻单台数据库的压力通过即可实现上述功能不仅可以支持也可以支持和一主一从读写分离配置控制后台数据库的读写分离和负载均衡有文件标签的属性控制存在的问题主节点主库宕机之后业务系统就只能够读而不能写入数据了为了高可用创建双主双从读写分离的数据库双主双从介绍一个主机用于处理所有写请求它的从机和另一台主机还有他的从机负责所有读请求当主机宕机后主机否则写请求互为备机架构图如下准备我们需要准备台服务器具体的服务器及软件安装情况如下搭建主库配置修改配置文件重启服务器主库配置两台主库创建账号并授权两台主库操作相同从库配置从库配置两台从库配置关联的主库两台主库相互复制双主双从读写分离配置控制后台数据库的读写分离和负载均衡有文件标签的属性控制通过及来完成失败自动切换的测试登录测试查询机更新操作判定是否能够进行读写分离以及读写分离的策略是否正确当主库挂掉一个之后是否能够自动切换',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-28 23:47:00',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/1711095406-u1644142392678189819fm253fmtautoapp138fJPEG.webp"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/beginner-Chun" title="GitHub"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="GitHub"/><span class="back-menu-item-text">GitHub</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://gitee.com/beginner-chun" title="Gitee"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="Gitee"/><span class="back-menu-item-text">Gitee</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">ifChun</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=1708664797&amp;server=tencent"><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 箴言</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src="/null"/></a><div class="post-qr-code-desc"></div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src="/null"/></a><div class="post-qr-code-desc"></div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Ajax/" style="font-size: 1.05rem; color: rgb(120, 1, 164);">Ajax<sup>1</sup></a><a href="/tags/CSS/" style="font-size: 1.05rem; color: rgb(82, 31, 189);">CSS<sup>1</sup></a><a href="/tags/ES/" style="font-size: 1.05rem; color: rgb(107, 46, 151);">ES<sup>2</sup></a><a href="/tags/Electron/" style="font-size: 1.05rem; color: rgb(28, 42, 166);">Electron<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem; color: rgb(101, 156, 147);">JavaScript<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem; color: rgb(136, 132, 77);">Linux<sup>1</sup></a><a href="/tags/MarkDown/" style="font-size: 1.05rem; color: rgb(181, 18, 192);">MarkDown<sup>1</sup></a><a href="/tags/MySQL/" style="font-size: 1.05rem; color: rgb(158, 195, 113);">MySQL<sup>1</sup></a><a href="/tags/Mybatis/" style="font-size: 1.05rem; color: rgb(28, 20, 49);">Mybatis<sup>1</sup></a><a href="/tags/Mybatis-Plus/" style="font-size: 1.05rem; color: rgb(11, 136, 55);">Mybatis-Plus<sup>1</sup></a><a href="/tags/RabbitMQ/" style="font-size: 1.05rem; color: rgb(109, 22, 162);">RabbitMQ<sup>2</sup></a><a href="/tags/SQLserver/" style="font-size: 1.05rem; color: rgb(125, 16, 97);">SQLserver<sup>1</sup></a><a href="/tags/SSM/" style="font-size: 1.05rem; color: rgb(176, 141, 114);">SSM<sup>1</sup></a><a href="/tags/SpringAi/" style="font-size: 1.05rem; color: rgb(52, 184, 48);">SpringAi<sup>1</sup></a><a href="/tags/SpringBoot/" style="font-size: 1.05rem; color: rgb(50, 19, 44); font-weight: 500; color: var(--anzhiyu-lighttext)">SpringBoot<sup>1</sup></a><a href="/tags/SpringCloud/" style="font-size: 1.05rem; color: rgb(188, 174, 96);">SpringCloud<sup>1</sup></a><a href="/tags/SpringSecurity/" style="font-size: 1.05rem; color: rgb(168, 162, 72);">SpringSecurity<sup>1</sup></a><a href="/tags/TypeScript/" style="font-size: 1.05rem; color: rgb(54, 32, 195);">TypeScript<sup>1</sup></a><a href="/tags/docker-%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 1.05rem; color: rgb(79, 169, 16);">docker, 微服务<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem; color: rgb(62, 148, 97);">git<sup>1</sup></a><a href="/tags/html/" style="font-size: 1.05rem; color: rgb(122, 34, 84);">html<sup>1</sup></a><a href="/tags/react/" style="font-size: 1.05rem; color: rgb(54, 10, 114);">react<sup>1</sup></a><a href="/tags/redis/" style="font-size: 1.05rem; color: rgb(119, 157, 7); font-weight: 500; color: var(--anzhiyu-lighttext)">redis<sup>2</sup></a><a href="/tags/uniapp/" style="font-size: 1.05rem; color: rgb(17, 53, 30);">uniapp<sup>2</sup></a><a href="/tags/vue/" style="font-size: 1.05rem; color: rgb(20, 24, 77);">vue<sup>2</sup></a><a href="/tags/webpack/" style="font-size: 1.05rem; color: rgb(196, 43, 64);">webpack<sup>1</sup></a><a href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 1.05rem; color: rgb(10, 163, 98);">微信小程序<sup>2</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 1.05rem; color: rgb(43, 173, 180);">操作系统<sup>1</sup></a><a href="/tags/%E6%96%87%E8%A8%80%E6%96%87/" style="font-size: 1.05rem; color: rgb(88, 105, 84);">文言文<sup>1</sup></a><a href="/tags/%E6%97%A5%E5%BF%97/" style="font-size: 1.05rem; color: rgb(27, 49, 164);">日志<sup>11</sup></a><a href="/tags/%E7%95%99%E5%80%99%E4%BC%A0/" style="font-size: 1.05rem; color: rgb(133, 195, 150);">留候传<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" style="font-size: 1.05rem; color: rgb(121, 108, 123);">计算机组成原理<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">七月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">六月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">35</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url">数据库</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/MySQL/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>MySQL</span></a></span></div></div><h1 class="post-title" itemprop="name headline">MySQL笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-05-09T10:50:00.000Z" title="发表于 2024-05-09 18:50:00">2024-05-09</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-08-28T15:47:00.597Z" title="更新于 2024-08-28 23:47:00">2024-08-28</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">18.6k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>61分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL笔记"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为广西"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>广西</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/9d742708167ba170dd0f5999451e0060.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://www.dachun.icu/2024/05/09/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87/"><header><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url">数据库</a><a href="/tags/MySQL/" tabindex="-1" itemprop="url">MySQL</a><h1 id="CrawlerTitle" itemprop="name headline">MySQL笔记</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Huang_Chun</span><time itemprop="dateCreated datePublished" datetime="2024-05-09T10:50:00.000Z" title="发表于 2024-05-09 18:50:00">2024-05-09</time><time itemprop="dateCreated datePublished" datetime="2024-08-28T15:47:00.597Z" title="更新于 2024-08-28 23:47:00">2024-08-28</time></header><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="用命令行窗口连接MySQL数据库"><a href="#用命令行窗口连接MySQL数据库" class="headerlink" title="用命令行窗口连接MySQL数据库"></a>用命令行窗口连接MySQL数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql  <span class="operator">-</span>h 主机名  <span class="operator">-</span>p 端 <span class="operator">-</span>u 用户名 <span class="operator">-</span>p 密码</span><br><span class="line"># 登陆前保证服务启动</span><br><span class="line">net stop mysql</span><br><span class="line">net <span class="keyword">start</span> mysql</span><br></pre></td></tr></table></figure>

<h3 id="使用指令创建数据库"><a href="#使用指令创建数据库" class="headerlink" title="使用指令创建数据库"></a>使用指令创建数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database 数据库名 #使用指令创建数据库</span><br><span class="line"><span class="keyword">drop</span> database 数据库名 #使用指令删除数据库</span><br><span class="line">#创建一个使用utf<span class="number">-8</span>字符集的数据库</span><br><span class="line"><span class="keyword">create</span> database 数据库名 <span class="type">character</span> <span class="keyword">set</span> utf<span class="number">-8</span></span><br></pre></td></tr></table></figure>

<h3 id="数据库备份恢复操作"><a href="#数据库备份恢复操作" class="headerlink" title="数据库备份恢复操作"></a>数据库备份恢复操作</h3><blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#显示数据库语句</span><br><span class="line"><span class="keyword">show</span> databases;</span><br><span class="line">#显示接口创建语句</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> database 数据库名</span><br><span class="line">#备份数据库（在DOS执行）</span><br><span class="line">mysql <span class="operator">-</span>u用户名 <span class="operator">-</span>p 密码 <span class="operator">-</span>b 数据库<span class="number">1</span>，数据库<span class="number">2</span><span class="operator">&gt;</span>文件名.<span class="keyword">sql</span></span><br><span class="line">#恢复数据库</span><br><span class="line">source 文件名.<span class="keyword">sql</span></span><br><span class="line">#备份库的表</span><br><span class="line">mysqldump <span class="operator">-</span>u 用户名 <span class="operator">-</span>p 密码 数据库 表<span class="number">1</span>，表<span class="number">2</span> <span class="operator">&gt;</span> d:<span class="operator">/</span><span class="operator">/</span>文件名.<span class="keyword">sql</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><blockquote>
<p>char(n) 长度为 $\mathrm{n}$ 的字符型</p>
<p>VARCHAR(n) 最大长度为 $\mathrm{n}$ 的变长字符型</p>
<p>NUMBER(n) 长度为 $\mathrm{n}$ 的数字型</p>
<p>INT 长整型 (4B)</p>
<p>SMALLINT 短整型 (2B)</p>
<p>BIGINT 大整型 (8B)</p>
<p>FLOAT(n) 精度至少为 n 位数字的浮点数</p>
<p>DATE 日期，格式为 YYYY-MM-DD</p>
<p>TIME 时间，格式为 HH:MM:SS</p>
</blockquote>
<h3 id="表操作"><a href="#表操作" class="headerlink" title="表操作"></a>表操作</h3><blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#创建表</span><br><span class="line"><span class="keyword">create</span>  <span class="keyword">table</span> 表名（</span><br><span class="line">id <span class="type">int</span>，</span><br><span class="line">）<span class="type">character</span> <span class="keyword">set</span> 字符集</span><br><span class="line"># 添加数据：</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 <span class="keyword">values</span>（）</span><br><span class="line"># 查询表</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表名 </span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 添加列</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span>（xxx xxx,xxxx xxx）;</span><br><span class="line"># 修改列</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 modify （xx xxx，xx xx）；</span><br><span class="line"># 删除列</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> （）；</span><br><span class="line"></span><br><span class="line">查看表的结构：<span class="keyword">desc</span>  表名</span><br><span class="line"></span><br><span class="line">修改表名：rename <span class="keyword">table</span> 表名 <span class="keyword">to</span> 新表名</span><br><span class="line"></span><br><span class="line">修改表字符集 <span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="type">character</span> <span class="keyword">set</span> 字符集</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ol>
<li><p>insert 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 <span class="keyword">values</span> （）；</span><br></pre></td></tr></table></figure>
</li>
<li><p>insert into 表名 values （），（）…形式添加多条记录</p>
</li>
<li><p>如果是给表中的所有字段添加数据，可以不写前面的字段名称</p>
</li>
<li><p>默认值的使用，当不给某个字段值时，如果有默认值就会添加默认值</p>
</li>
<li><p>update 语句</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> 表名 <span class="keyword">set</span> 列名 <span class="operator">=</span> xxx <span class="keyword">where</span> 条件；</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>update语法可以用新值更新原有表行中的各列</p>
</li>
<li><p>set 子句 指示要修改哪些行，和要给予哪些值。</p>
</li>
<li><p>where子句指定更新哪些行，如果没有 where 子句，则更新所有的行。</p>
</li>
<li><p>如果需要修改多个字段，可以通过set字段名 &#x3D; 值1，字段名 &#x3D; 值2 where xxx；</p>
</li>
</ul>
<ol start="3">
<li>delete语句</li>
</ol>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名 <span class="keyword">where</span> xxx；</span><br></pre></td></tr></table></figure>

<ul>
<li><p>如果不适用where子句，将删除表中所有数据。</p>
</li>
<li><p>delete语句不能删除某一列的值，可以使用update 设为null或者‘’</p>
</li>
<li><p>使用delete语句仅删除记录不删除表本身，如要删除表，使用drop table 语句，drop table 表名。</p>
</li>
</ul>
<ol start="4">
<li>select语句</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 一般格式</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span><span class="operator">/</span><span class="keyword">ALL</span> 目标列表达式 <span class="comment">-- 要显示的属性列</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> 表名<span class="operator">/</span>视图名 <span class="comment">-- 查询的对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WHERE</span> 条件表达式 <span class="comment">-- 查询条件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> 列名 <span class="keyword">HAVING</span> 条件表达式 <span class="comment">-- 查询结果分组</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 列名 次序； <span class="comment">-- 最终查询结果排序</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> （表达式） <span class="keyword">from</span> 表名 </span><br></pre></td></tr></table></figure>

<ul>
<li><p>select语句中可以使用as语句</p>
</li>
<li><p>select 列名 as别名 from 表名</p>
</li>
</ul>
</blockquote>
<h3 id="在where子句中经常使用的运算符"><a href="#在where子句中经常使用的运算符" class="headerlink" title="在where子句中经常使用的运算符"></a>在where子句中经常使用的运算符</h3><blockquote>
<p>（1）比较运算符</p>
<ul>
<li><p>&lt;, &gt; ,&gt;&#x3D;…..</p>
</li>
<li><p>between … and..显示在某一区间的值 </p>
</li>
<li><p>in（set）显示在in列表中的值</p>
</li>
<li><p>like ‘ ’，not like‘ ’模糊查询 %表示0到多个任意字符，_表示单个任意字符</p>
</li>
<li><p>is null 判断是否为空</p>
</li>
</ul>
<p>（2）逻辑运算符</p>
<ol>
<li><p>and 多个条件同时成立</p>
</li>
<li><p>or多个条件任一成立</p>
</li>
<li><p>not 不成立</p>
</li>
</ol>
<p>（3）使用order by子句排序查询结果。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表名 <span class="keyword">order</span> <span class="keyword">by</span> 列名</span><br></pre></td></tr></table></figure>

<ul>
<li><p>order by指定排序的列，排序的列既可以是表中的列名，也可以是select 语句后指定列名（别名）</p>
</li>
<li><p>asc（升序）默认，desc降序</p>
</li>
<li><p>order by 子句应位于select 语句的结尾。</p>
</li>
</ul>
<p>(4) Group By</p>
<ol>
<li><code>GROUP BY</code>子句用于将结果集按照一个或多个列进行分组。它通常和聚合函数（如<code>SUM</code>, <code>COUNT</code>, <code>AVG</code>等）一起使用，以便对每个组应用聚合函数。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> employee_count</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department;</span><br></pre></td></tr></table></figure>

<p>根据<code>department</code>列对<code>employees</code>表进行分组，并计算每个部门的员工数量。</p>
<ol start="2">
<li>Having</li>
</ol>
<p><code>HAVING</code>子句用于过滤分组后的结果。它类似于<code>WHERE</code>子句，但是可以在分组后应用    v条件。 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> employee_count</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>在9的例子中，我们只选择具有超过5名员工的部门。</p>
<ol start="3">
<li>Top</li>
</ol>
<p>在SQL中，没有<code>TOP</code>关键字，不过在一些数据库系统中（如SQL Server），可以使用<code>TOP</code>来限制返回的行数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">5</span> <span class="operator">*</span> <span class="keyword">FROM</span> products;</span><br></pre></td></tr></table></figure>

<p>这条SQL语句将返回<code>products</code>表中的前5行记录。</p>
</blockquote>
<h3 id="字符串数据类型"><a href="#字符串数据类型" class="headerlink" title="字符串数据类型"></a>字符串数据类型</h3><blockquote>
<ol>
<li>字符串的基本使用</li>
</ol>
<p>char（size） 固定长度字符串最大255个字符</p>
<p>vachar（size） 0 - 65535</p>
<p>可变长度字符串最大65532字节（utf - 8编码最大21844字符，1-3个字节用于记录大小）</p>
<ol start="2">
<li><p>如果数据是定长，使用char，比如密码，邮编，手机号</p>
</li>
<li><p>如果数据（一个字段）是不确定，使用varchar 比如文章。</p>
</li>
<li><p>查询速度：char &gt; varchar。</p>
</li>
</ol>
</blockquote>
<blockquote>
<ol>
<li><p>charset（str）返回字符串字符集</p>
</li>
<li><p>concat（str2 […]）连接字符串，将多个列拼接成一列</p>
</li>
<li><p>instr（string ，substring）返回substring 在string 中出现的位置（没有返回0）</p>
</li>
<li><p>ucase（string）转换成大写</p>
</li>
<li><p>lcase（string）转换成小写</p>
</li>
<li><p>left（string，length）从string中的左边起取length个字符</p>
</li>
<li><p>right与⑥相反</p>
</li>
<li><p>length（string）string长度（按照字节计算）</p>
</li>
<li><p>replace（str，str1，str2）在str中str2替换成str1</p>
</li>
<li><p>strcmp（string1，string2）逐字符比较两个字符串大小。</p>
</li>
<li><p>substring（str，position，length）从str的position开始取length个字符</p>
</li>
<li><p>ltrim（string）rtrim（string）去除前端或者后端空格 trim （string）去除左右两端空格。</p>
</li>
</ol>
</blockquote>
<h3 id="时间日期相关函数"><a href="#时间日期相关函数" class="headerlink" title="时间日期相关函数"></a>时间日期相关函数</h3><blockquote>
<ol>
<li><p>current_date（）当前日期</p>
</li>
<li><p>current_time（）当前时间</p>
</li>
<li><p>current_timestamp（）当前时间戳</p>
</li>
<li><p>date（datetime）返回datetime的日期部分</p>
</li>
<li><p>now（）当前时间</p>
</li>
</ol>
</blockquote>
<h3 id="数学相关函数"><a href="#数学相关函数" class="headerlink" title="数学相关函数"></a>数学相关函数</h3><blockquote>
<ol>
<li><p>abs（num）绝对值</p>
</li>
<li><p>bin（num）十进制转换成二进制</p>
</li>
<li><p>ceiling（num）向上取整，得到比num大的最小整数。</p>
</li>
<li><p>conv（num，进制，进制）直接转换</p>
</li>
<li><p>floor（num）向下取整，得到比num小的最大整数</p>
</li>
<li><p>format（num1，保留小数位）保留小数位（四舍五入）</p>
</li>
<li><p>least（num1，num2，num3）求最小值</p>
</li>
<li><p>mod（num，num1）求余</p>
</li>
<li><p>rand（）&#x2F;（seed）返回随机值</p>
</li>
</ol>
</blockquote>
<h3 id="加密和系统函数"><a href="#加密和系统函数" class="headerlink" title="加密和系统函数"></a>加密和系统函数</h3><blockquote>
<ol>
<li><p>user（）查询用户</p>
</li>
<li><p>datebase（）查询当前使用的数据库名称</p>
</li>
<li><p>md5（str）为字符串算出一个md5,32的字符串，常用于（用户密码）加密</p>
</li>
<li><p>password（)加密函数</p>
</li>
</ol>
</blockquote>
<h3 id="流程控制函数"><a href="#流程控制函数" class="headerlink" title="流程控制函数"></a>流程控制函数</h3><blockquote>
<ol>
<li><p><code>if（exper1，expr2，expr3）</code>如果expr1为True，则返回expr3，否则返回expr3</p>
</li>
<li><p><code>ifnull （expr1，expr2）</code>如果expr1不为空null，则返回expr1，否则返回expr2.</p>
</li>
<li><p><code>select case when expr1 then expr2 when expr3 then expr4 else expr5 end</code>（类似多重分支）如果expr1为True，则返回expr2，如果expr3为True返回expr4，否则返回expr5.</p>
</li>
</ol>
</blockquote>
<h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> .... limit <span class="keyword">start</span> ,<span class="keyword">rows</span>;</span><br></pre></td></tr></table></figure>

<p>表示start + 1行开始取，取出rows行，start从0开始计算（每页显示记录数）*（第几页 -1），每页显示记录数</p>
</blockquote>
<h3 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h3><h4 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a><strong>自连接</strong></h4><blockquote>
<ol>
<li><p>把同一张表当做两张表使用。</p>
</li>
<li><p>需要给表取别名，表名 表别名</p>
</li>
<li><p>列名不明确，可以指定列的别名 列名 as新列名</p>
</li>
</ol>
</blockquote>
<h4 id="左外连接"><a href="#左外连接" class="headerlink" title="左外连接"></a><strong>左外连接</strong></h4><blockquote>
<ol>
<li>左侧的表完全显示。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ... <span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">left</span> <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 条件</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="右外连接"><a href="#右外连接" class="headerlink" title="右外连接"></a><strong>右外连接</strong></h4><blockquote>
<ol>
<li>右侧的表完全显示。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ...<span class="keyword">from</span> 表<span class="number">1</span> <span class="keyword">right</span> <span class="keyword">join</span> 表<span class="number">2</span> <span class="keyword">on</span> 条件</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h3><blockquote>
<p>&#x3D;&#x3D;primary key（主键）&#x3D;&#x3D;</p>
<ol>
<li><p>用于唯一标识表行的数据，当定义主键约束后，该列的值不能重复。</p>
</li>
<li><p>细节：</p>
</li>
</ol>
<ul>
<li><p>primary key 不能重复而且不能为null</p>
</li>
<li><p>一张表最多只能有一个主键，但可以是复合主键。</p>
</li>
<li><p>直接在字段名后指定：字段名 primary key</p>
</li>
<li><p>在表定义最后写primary key（列名）</p>
</li>
</ul>
<p>&#x3D;&#x3D;not null&#x3D;&#x3D;</p>
<p>&#x3D;&#x3D;unique（唯一）&#x3D;&#x3D;</p>
<ol>
<li><p>定义：当定义了唯一约束后，该列值不能重复</p>
</li>
<li><p>语法格式：字段名 字段类型 unique</p>
</li>
<li><p>细节：</p>
<p>①如果没有指定not null，则unique字段可以有多个null</p>
<p>②一张表可以有多个unique</p>
</li>
</ol>
<p>&#x3D;&#x3D;foreign key（外键）&#x3D;&#x3D;</p>
<ol>
<li>用于定义主表和从表之间的关系：外键约束要定义在从表上，主表则必须具有主键约束或者是unique约束，当定义外键约束后，要求外键列数据必须在主表的主键列存在或者是为null。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreign</span> key （本表字段名） <span class="keyword">references</span> 主表名（主键名或者是<span class="keyword">unique</span>字段名）</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>外键指向的表的字段，要求是primary key 或者是 unique </p>
</li>
<li><p>表的类型是innodb，这样的表才支持外键</p>
</li>
<li><p>外键的字段的类型要求和主键字段的类型一致（长度可以不同）</p>
</li>
<li><p>外键的字段值，必须在主键字段中出现过，工作为null（前提是外键字段允许为null）</p>
</li>
<li><p>一旦建立外键关系，数据不能随意删除</p>
</li>
</ol>
<p>&#x3D;&#x3D;自增长&#x3D;&#x3D;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字段名 整形 <span class="keyword">primary</span> key auto_increment；</span><br></pre></td></tr></table></figure>

<ol>
<li><p>一般来说自增长是和primary key 配合使用的</p>
</li>
<li><p>自增长也可以单独使用（但需要配合一个unique）</p>
</li>
<li><p>自增长修饰的字段为整数型的</p>
</li>
<li><p>自增长默认从1开始，可用通过命令修改</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 auto_increment <span class="operator">=</span> 新值；</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>如果添加数据是给自增长字段指定值时，以指定值为准。</li>
</ol>
</blockquote>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><blockquote>
<p>（1）定义：事务用于保证数据的一致性，它有一组相关的dml语句组成，该组dml语句要么全部成功，要么全部失败。</p>
<p>（2）事务和锁</p>
<p>当执行事务操作，mysql会在表上加锁。防止其他用户修改表的数据</p>
<p>（3）mysql数据库控制台事务的几个重要操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">start</span> transaction #开始一个事务</span><br><span class="line"># <span class="keyword">sql</span> server 中为<span class="keyword">begin</span> transaction；</span><br><span class="line"><span class="keyword">savepoint</span> 保存点名  #设置一个保存点</span><br><span class="line"># <span class="keyword">sql</span> server 中为save transaction 保存点名</span><br><span class="line"><span class="keyword">rollback</span> <span class="keyword">to</span> 保存点名  #回退事务</span><br><span class="line"></span><br><span class="line"><span class="keyword">rollback</span>   #回退全部事务 </span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span> #提交事务，所有的操作生效，不能回退</span><br></pre></td></tr></table></figure>

<p>（4）提交事务</p>
<p>使用commit语句可以提交事务，当执行了commit语句后，会确认事务的变化，结束事务，删除保存点，释放锁，数据生效。当使用commit语句后结束无所谓，其他会话将可以查看到事务变化后的新数据。</p>
<p>（5）细节</p>
<ol>
<li><p>如果不开始事务，默认情况下，dml操作是自动提交的，不能回滚。</p>
</li>
<li><p>如果开始一个事务，但没有创建保存点，可以执行rollback默认回退到开始的状态。</p>
</li>
<li><p>可以在事务没有提交前，选择回退哪个保存点</p>
</li>
<li><p>innodb存储引擎支持事务，myisam不支持、</p>
</li>
<li><p>开始一个事务，set autocommit&#x3D; off；</p>
</li>
</ol>
<p>（6）事务隔离级别</p>
</blockquote>
<h3 id="事务的四大特性（ACID）"><a href="#事务的四大特性（ACID）" class="headerlink" title="事务的四大特性（ACID）"></a>事务的四大特性（ACID）</h3><blockquote>
<p>原子性(Atomicity)：事务是不可分割的最小操作单元，要么全部成功，要么全部失败。</p>
<p>一致性（Consistency）：事务完成时，必须使所有的数据都保存一致状态。</p>
<p>隔离性（Isolation）：数据库系统的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行。</p>
<p>持久性（Durability）：事务一旦提交或回滚，它对数据库中的数据的改变是永久的。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240713221639325.png" alt="image-20240713221639325"></p>
</blockquote>
<h3 id="并发事务问题"><a href="#并发事务问题" class="headerlink" title="并发事务问题"></a>并发事务问题</h3><blockquote>
<p><code>脏读</code>：一个事务读到另外一个事务还没有提交的数据。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240713222814778.png" alt="image-20240713222814778"></p>
<p>事务B读取到事务A还没提交的事务，会产生数据的不一致。</p>
<p><code>不可重复读</code>：一个事务先后读取同一条记录，但两次读取的数据不同，称为不可重复读。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240713223139289.png" alt="image-20240713223139289"></p>
<p>事务A的第一次读取和第二次读取的数据不一致，因为在两次执行的间隙中事务B执行完成修改了数据。</p>
<p><code>幻读</code>:一个事务按照条件查询数据时，没有对应的数据行，但是在插入数据时，有发现这行数据已经存在，好像出现了”幻影”。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240713223808245.png" alt="image-20240713223808245"></p>
<p>当事务A查询id&#x3D;1时没有查询到，因为数据库不存在该数据。此时，事务B插入id&#x3D;1的数据，并提交事务B；接着事务A也想插入id&#x3D;1的数据，但是不能插入因为id为主键，不能重复。这时事务A想查询id&#x3D;1的数据，不能查询因为是<code>可重复读了</code>。需要事务A也提交事务才能查询。</p>
</blockquote>
<h3 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h3><blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240713223944511.png" alt="image-20240713223944511"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询事务隔离级别</span></span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@transaction_isolation</span>;</span><br><span class="line"><span class="comment">-- 设置事务管理级别</span></span><br><span class="line"><span class="keyword">set</span> [session<span class="operator">|</span><span class="keyword">global</span>] transaction isolation level&#123;read uncommitted<span class="operator">|</span>read committed<span class="operator">|</span>repeatable read<span class="operator">|</span> serializable&#125;</span><br></pre></td></tr></table></figure>

<p>serializable:一次只能执行一个事务，当事务A提交后才能执行事务B。</p>
<p><strong>注意</strong>：事务隔离级别越高，数据越安全，但是性能越低。</p>
</blockquote>
<h2 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><p><strong>MySQL体系结构</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240713231906147.png" alt="image-20240713231906147"></p>
<p><strong>简介</strong></p>
<blockquote>
<p>存储引擎就是存储数据，建立索引，更新&#x2F;查询数据等技术的实现方式。存储引擎是<code>基于表的</code>，而不是基于库的，所以存储引擎也可被称为表类型。存储引擎没有好坏之分，在适当场景下，使用不同的存储引擎，各个存储引擎各有优劣势。</p>
</blockquote>
<blockquote>
<p>查看所有引擎: <code>show engines</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(</span><br><span class="line">字段<span class="number">1</span> 字段类型，</span><br><span class="line">字段<span class="number">2</span> 字段类型，</span><br><span class="line">)engine <span class="operator">=</span> &quot;存储引擎名&quot;;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240715215833930.png" alt="image-20240715215833930"></p>
</blockquote>
<h3 id="存储引擎特点"><a href="#存储引擎特点" class="headerlink" title="存储引擎特点"></a>存储引擎特点</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240715222459666.png" alt="image-20240715222459666"></p>
<p><strong>InnoDB</strong></p>
<blockquote>
<p>介绍：InnoDB是一种兼顾高可靠性和高性能的通用存储引擎，在MySQL5.5之后，InnoDB是默认的MySQL存储引擎。</p>
<p>特点：</p>
<ul>
<li>DML(数据的增删改)操作遵循ACID模型，支持<code>事务</code>;</li>
<li><code>行级锁</code>，提高并发访问性能；</li>
<li>支持<code>外键</code>foreign key约束，保证数据的完整性和正确性。</li>
</ul>
<p>文件：</p>
<p>xxx.ibd:xxx代表的是表名，innoDB引擎的每张表都会对应这样一个表空间文件，存储该表的表结构(frm,sdi)、数据和索引。参数：innodb_file_pre_table.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240715221021679.png" alt="image-20240715221021679"></p>
<p>逻辑存储结构：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240715221518555.png" alt="image-20240715221518555"></p>
</blockquote>
<p><strong>MyISAM</strong></p>
<blockquote>
<p>介绍：MyISAM是MySQL早期使用的存储引擎。</p>
<p>特点：</p>
<ol>
<li><p>添加速度快</p>
</li>
<li><p>不支持外键和事务</p>
</li>
<li><p>支持表级锁，不支持行锁</p>
</li>
</ol>
<p>文件：</p>
<p>xxx.sdi:存储表结构信息</p>
<p>xxx.MYD:存储数据</p>
<p>xxx.MYI:存储索引</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240715221932522.png" alt="image-20240715221932522"></p>
</blockquote>
<p><strong>memory</strong></p>
<blockquote>
<p>介绍：Memory引擎的表数据时存储在内存中，由于受到硬件问题或断电问题的影响，只能将这些表作为临时表或缓存使用。</p>
<p>特点：</p>
<ol>
<li><p>数据存储在内存中</p>
</li>
<li><p>执行速度快，没有io读写</p>
</li>
<li><p>默认支持索引（hash表）</p>
</li>
</ol>
<p>文件：</p>
<p>xxx.sdi:存储表结构信息</p>
</blockquote>
<h3 id="存储引擎选择"><a href="#存储引擎选择" class="headerlink" title="存储引擎选择"></a>存储引擎选择</h3><blockquote>
<p>在选择存储引擎时，应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统还可以根据实际情况选择多种存储引擎进行组合。绝大数业务场景使用innoDB存储</p>
<ol>
<li>InnoDB：是MySQL的默认存储引擎，支持事务，外键。如果应用对事务的完整性有比较高的要求，在并发条件下引擎数据的一致性，数据操作除了插入和查询之外，还包含很多的更新，删除操作，那么InnoDB存储引擎是比较合适的选择。</li>
<li>MyISAM：如果应用时以读操作和插入操作为主，只有很少的更新和删除操作，并且对事物的完整性，并发性要求不高，那么选择这个存储索引是非常合适的。已被MongoDB取代。</li>
<li>Memory：将所有数据保存在内存中，访问速度快，通常用于临时表以及缓存。Memory的缺陷就是对表的大小有限制，太大的表无法缓存在内存中，而且无法保证数据的安全性。</li>
</ol>
</blockquote>
<blockquote>
<p>（1）myisam存储引擎</p>
<ol>
<li><p>添加速度快</p>
</li>
<li><p>不支持外键和事务</p>
</li>
<li><p>支持表级锁</p>
</li>
</ol>
<p>（2）Innodb存储引擎:</p>
<ol>
<li><p>支持事务和外键</p>
</li>
<li><p>支持行级锁</p>
</li>
</ol>
<p>（3）memory存储引擎</p>
<ol>
<li><p>数据存储在内存中</p>
</li>
<li><p>执行速度快，没有io读写</p>
</li>
<li><p>默认支持索引（hash表）</p>
</li>
</ol>
<p>（4）如何选择表的存储引擎</p>
<ol>
<li><p>如果应用不需要事务，处理的知识基本的crud操作，那么myisam是不二选择，速度快。</p>
</li>
<li><p>如果需要支持事务，选择innodb</p>
</li>
</ol>
<p>修改存储引擎</p>
<p><code>alter table 表名 engine = xxx</code></p>
</blockquote>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><h3 id="索引概述"><a href="#索引概述" class="headerlink" title="索引概述"></a>索引概述</h3><blockquote>
<p>介绍：索引(index)是帮助MySQL<code>高效获取数据</code>的<code>数据结构</code>(有序)。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用指向数据，这样就可以在这些数据结构实现国际查找算法，这种数据结构就是索引。</p>
<p>演示：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240715230006578.png" alt="image-20240715230006578"></p>
<p>优势：</p>
<ul>
<li>提高数据检索的效率，降低数据库的IO成本</li>
<li>通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗</li>
</ul>
<p>劣势：</p>
<ul>
<li>索引列需要占用空间(可以忽略不计)</li>
<li>索引订单提高了查询效率，同时也降低更新表的速度，如对表继续insert，update，delete，效率降低。但是在一个业务系统增删改的操作较少，可以忽略。</li>
</ul>
</blockquote>
<h3 id="索引结构"><a href="#索引结构" class="headerlink" title="索引结构"></a>索引结构</h3><blockquote>
<p>MySQL的索引是在存储引擎层实现的，不同存储引擎有不同的结构，主要包含以下几种：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240715230646901.png" alt="image-20240715230646901"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240715230711791.png" alt="image-20240715230711791"></p>
<p>如果没有特别指定，都是指<code>B+树结构</code>组织的索引。</p>
</blockquote>
<p><strong>B-Tree(多路平衡查找树)</strong></p>
<blockquote>
<p>以一棵最大度数为5的b-tree为例(每个节点最多存储四个key，5个指针)：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240715231620389.png" alt="image-20240715231620389"></p>
</blockquote>
<p><strong>B+Tree</strong></p>
<blockquote>
<p>以一棵最大度数为4的b-tree为例(4阶)的b+tree为例：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240715232457520.png" alt="image-20240715232457520"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240715232745032.png" alt="image-20240715232745032"></p>
<p>相对于B-Tree区别：</p>
<ol>
<li>所有的数据都会出现在叶子节点。</li>
<li>叶子节点形成一个双向链表</li>
</ol>
<p>MySQL索引数据结构对经典的B+Tree进行了优化，在原B+Tree的基础上，增加了指向相邻叶子节点的链表指针，就形成了带有顺序指针的B+Tree，提高期间访问的性能。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240715233200803.png" alt="image-20240715233200803"></p>
</blockquote>
<p><strong>Hash</strong></p>
<blockquote>
<p>哈希索引就是采用一点的Hash算法，将键值换算成新的Hash值，映射到对应的槽位上，然后存储在Hash表中。</p>
<p>如果两个(或多个)键值，映射到一个相同的槽位上，它们就产生了Hash冲突(也称为Hash碰撞)，可以通过链表来解决</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240715233618480.png" alt="image-20240715233618480"></p>
<p>特点：</p>
<ol>
<li>Hash索引只能用于对等比较(&#x3D;,in)，不支持范围查询(between,&gt;,&lt;…)</li>
<li>无法利用索引完成排序操作</li>
<li>查询效率高，通常只需要一次索引(不产生Hash冲突)就可以了，效率通常要高于B+Tree索引</li>
</ol>
</blockquote>
<p><strong>思考</strong>：为什么innoDB存储引擎选择使用B+Tree索引结构？</p>
<p>答：1. 相对于二叉树，层级更少，搜索效率高；</p>
<ol start="2">
<li>对于B-Tree，无论是叶子节点还是非叶子节点，都会保存数据，这样导致一页中存储的键值减少，指针跟着减少，要同样保存大量数据，只能增加数的高度，导致性能降低。</li>
<li>相对Hash索引，B+Tree支持范围匹配及排序操作(双向循环链表)。</li>
</ol>
<h3 id="索引分类"><a href="#索引分类" class="headerlink" title="索引分类"></a>索引分类</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240716205009598.png" alt="image-20240716205009598"></p>
<blockquote>
<p>在<code>InnoDB存储引擎</code>中，根据索引的存储形式，又可以分为以下两种：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240716205228271.png" alt="image-20240716205228271"></p>
<p>聚集索引选取规则：</p>
<ul>
<li>如果存在主键，<code>主键索引</code>就是聚集索引。</li>
<li>如果不支持主键，将使用第一个<code>唯一(unique)索引</code>作为聚集索引。</li>
<li>如果没有主键，或没有合适的唯一索引，则InnoDB会自动生成一个<code>rowid</code>作为隐藏的聚集索引。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240716205824487.png" alt="image-20240716205824487"></p>
<p><code>select * from user where name = &#39;Arm&#39;</code>的执行流程：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240716210258180.png" alt="image-20240716210258180"></p>
</blockquote>
<p>思考：1. 以下SQL语句，哪个执行效率高?为什么？</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240716210455378.png" alt="image-20240716210455378"></p>
<p>答：根据id查询的效率更高。根据id查询：直接根据聚集索引查询即可；</p>
<p>根据name查询：需要使用的二级索引查询到id值，再回表查询走聚集索引查询。</p>
<ol start="2">
<li>InnoDB主键索引的B+Tree高度为多高？</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240716211231761.png" alt="image-20240716211231761"></p>
<p>假设：一行数据大小为1K，一页中可以存储16行这样的数据。InnoDB的指针占用6个字节的空间，主键即使为bigint，占用字节数为8。(每页大小为16K)</p>
<p>高度为2：</p>
<p>n * 8 + (n + 1) * 6 &#x3D; 16 * 1024,得出n约为1170；</p>
<p>1170 * 16 &#x3D; 18736(条数据)</p>
<p>高度为3：</p>
<p>1171 * 1171 * 16 &#x3D; 21939856(条数据)</p>
<h3 id="索引语法"><a href="#索引语法" class="headerlink" title="索引语法"></a>索引语法</h3><blockquote>
<p>创建索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> [<span class="keyword">unique</span><span class="operator">|</span>fulltext] index 索引名 <span class="keyword">on</span> 表名（字段名, ...）</span><br></pre></td></tr></table></figure>

<p>查看索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> 表名；</span><br></pre></td></tr></table></figure>

<p>删除索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> index 索引名 <span class="keyword">on</span> 表名</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="SQL性能分析"><a href="#SQL性能分析" class="headerlink" title="SQL性能分析"></a>SQL性能分析</h3><blockquote>
<p><strong>SQL执行频率：</strong></p>
<p>MySQL客户端连接成功后，通过<code>show [session|global] status</code>命令提供服务器状态信息。通过如下指令，可以查看当前数据库的insert，update，delete，select的访问频次。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;com______&#x27;</span> #七个&quot;_&quot;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240716213533579.png" alt="image-20240716213533579"></p>
<p><strong>慢查询日志：</strong></p>
<p>慢查询日志记录了所有执行时间超过指定参数(long_query_time,单位：秒，默认10秒)的所有的SQL语句的日志。</p>
<p>MySQL的慢查询日志默认没有开启，需要在MySQL的配置文件(&#x2F;etc&#x2F;my.cnf)中配置如下信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询慢查询日志</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;slow_query_log&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240716213954937.png" alt="image-20240716213954937"></p>
<p>配置完毕之后，重启MySQL服务器，查看慢查询日志的记录信息“var&#x2F;lib&#x2F;mysql&#x2F;localhost-slow.log”.</p>
<p><strong>profile详情</strong></p>
<p><code>show profiles</code>能够在做SQL优化是帮助我们连接时间都消耗到哪里了。通过<code>have_profiling</code>参数，能够看到当前MySQL是否支持profile操作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @<span class="variable">@have_profiling</span>;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240716214740478.png" alt="image-20240716214740478"></p>
<p>默认profiling是<code>关闭的</code>，可以同set语句在session&#x2F;global级别开启profiling；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> profiling <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>执行一系列的业务SQL的操作，然后通过如下指令查看指令的执行耗时：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240716215245089.png" alt="image-20240716215245089"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240716215307924.png" alt="image-20240716215307924"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240716215408940.png" alt="image-20240716215408940"></p>
<p><strong>explain执行计划</strong></p>
<p>explain或desc命令获取MySQL如何执行select语句的信息，包括select语句执行过程中表如何连接和连接的顺序。</p>
<p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain<span class="operator">/</span><span class="keyword">desc</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> 表名 <span class="keyword">where</span> 条件；</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240716215928365.png" alt="image-20240716215928365"></p>
<p>explain执行聚合个字段含义：</p>
<ul>
<li><code>id</code>：select查询的序列号，表示查询中执行select子句或者是操作表的顺序(id相同，执行顺序从上到下；id不同，值越大，执行越优先)</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240716221004060.png" alt="image-20240716221004060"></p>
<ul>
<li><code>select_type</code>:表示selec的类型，创建的取值有simple(简单表)、primary(主程序，即外层的查询)&#x2F;union（union中第二个或者后面的查询语句）、subquery(select&#x2F;where之后包含了子查询)等。</li>
<li>**<code>type</code>**：表示连接类型，性能由好到差的连接类型为null，system、const。eq_ref、ref、range、index、all（全表扫描，性能低）.</li>
<li>**<code>possible_key</code>:**显示可能应用在这张表上的索引，一个或多个。</li>
<li><strong><code>key</code></strong>:实际使用的索引，如果为null，则没有使用索引。</li>
<li>**<code>key_len</code>**：表示索引中使用字节数，该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的前提下，长度越短越好。</li>
<li><strong><code>rows</code></strong>:MySQL认为必须要执行的行数，在InnoDB引擎的表中，是一个预估值，可能并不总是准确。</li>
<li><code>filtered</code>：表示返回结果的行数占需要读取的行数的百分比，filtered的值越大越好。</li>
</ul>
</blockquote>
<h3 id="索引使用原则"><a href="#索引使用原则" class="headerlink" title="索引使用原则"></a>索引使用原则</h3><blockquote>
<p><strong>最左前缀法则：</strong></p>
<p>如果索引了多列(联合索引)，要遵守最左前缀法则。最左前缀否则指的是查询从索引的最左列开始，并且不跳过索引中列。如果跳跃某一列，<code>索引将部分失效</code>(后面的字段索引失效)。与查询字段的位置无关，字段存在即可。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240717214120473.png" alt="image-20240717214120473"></p>
<p><strong>范围查询：</strong></p>
<p>联合索引中，出现范围查询(&gt;,&lt;)，范围查询右侧的列索引失效。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240717214728919.png" alt="image-20240717214728919"></p>
<p><strong>索引列运算</strong></p>
<p>不可在索引列上进行运算操作，索引将失效。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240717215156202.png" alt="image-20240717215156202"></p>
<p><strong>字符串不加引号</strong></p>
<p>字符串类型字段使用时，不加引号，索引将失效。字符和日期类型数据应包含在单引号中<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240717215511025.png" alt="image-20240717215511025"></p>
<p><strong>模糊查询</strong></p>
<p>如果解决是尾部模糊匹配，索引不会失效，如果是头部模糊匹配，索引失效。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240717215845007.png" alt="image-20240717215845007"></p>
<p><strong>or连接的条件</strong></p>
<p>用or分隔开的条件，如果or前的条件中的列有索引，而后面的列中没有索引，那么涉及的索引都不会被用到。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240717220315120.png" alt="image-20240717220315120"></p>
<p>由于age没有索引，所以即使id，Phone有索引，索引也会失效。所以需要针对于age也要建立索引。</p>
<p><strong>数据分布影响</strong></p>
<p>如果MySQL评估使用索引比全表扫描更慢，则不使用索引。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240717220939408.png" alt="image-20240717220939408"></p>
<p><strong>SQL提示</strong></p>
<p>SQL提示，是优化数据库的一个主要手段，简单来说，就是在SQL语句中加入一些人为的提示来达到优化操作的目的。</p>
<ul>
<li>use index:</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240717221619570.png" alt="image-20240717221619570"></p>
<ul>
<li>ignore index：</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240717221640024.png" alt="image-20240717221640024"></p>
<ul>
<li>force index:</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240717221659442.png" alt="image-20240717221659442"></p>
<p><strong>覆盖索引</strong></p>
<p>尽量使用覆盖索引(查询使用率索引，并且需要返回的列，在该索引中已经全部能够找到)，减少select *。</p>
<p><code>using index condition</code>：查找使用率索引，但是需要<code>回表查询</code>数据；</p>
<p>&#96;using where，using index：查找使用了索引，但是需要的数据都在索引列中能找到，所以不需要回表查询数据。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240717222620764.png" alt="image-20240717222620764"></p>
<p><strong>前缀索引</strong></p>
<p>当字段类型为字符串(varchar,text等)是，有时候需要索引很长的字符串，这会让<code>索引变得很大</code>，查询时，浪费大量的磁盘IO，影响查询效率。此时可以只将字符串的一部分前缀，建立索引，这样可以大大节约索引空间，从而提高索引效率。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_xxx <span class="keyword">on</span> table_name(<span class="keyword">column</span>(n)); <span class="comment">-- n表示截取的长度</span></span><br></pre></td></tr></table></figure>

<p><code>前缀长度</code>：可以根据索引的选择性来决定就，二选择性是只不重复的索引值(基数)和数据表的记录总数的比值，索引选择性越高则查询效率越高，唯一索引的<code>选择性是1</code>，这是最好的索引选择性，性能也是最好的。</p>
<p>选择性求法：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719153641145.png" alt="image-20240719153641145"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719154422047.png" alt="image-20240719154422047"></p>
<p><strong>单列索引与联合索引</strong></p>
<p>单列索引：即一个索引值包含单个字段</p>
<p>联合索引：即一个索引值包含多个字段</p>
<p>在业务场景中，如果存在多个查询条件，考虑针对于字段建立索引是，建议建立联合索引，而非单列索引。</p>
<p><code>多条件</code>联合查询时，MySQL优化器会评估哪个字段的索引效率更高，会选择该索引完成本次查询。</p>
<p>联合索引情况：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719155652065.png" alt="image-20240719155652065"></p>
</blockquote>
<h3 id="索引设计原则"><a href="#索引设计原则" class="headerlink" title="索引设计原则"></a>索引设计原则</h3><blockquote>
<ol>
<li>针对于数据量较大，且查询比较频繁的表建立索引(十万级别的数据)。</li>
<li>针对于常作为查询条件(where),排序(order by)。分组(group by)操作的字段建立索引。</li>
<li>尽量选择区分度高的列作为索引，尽量建立唯一索引，区分度越高，使用索引的效率越高。</li>
<li>如果是字符串的字段，字段的长度较长，可以针对于字段的特点，建立前缀索引。</li>
<li>尽量使用联合索引，减少单列索引，查询是，联合索引很多时候一覆盖索引，节省存储空间，避免回表查询，提高查询效率。需要遵循最左前缀法。</li>
<li>要控制索引的数量，索引并不是多多益善，索引越多，维护索引结构的代价越大，会影响增删改的效率。</li>
<li>如果索引列不能存储null值，需要在创建表时使用not null约束他，当优化器知道每列是否包含null值时，它可以更好地确定哪个索引最有效地用于查询。</li>
</ol>
</blockquote>
<blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index 索引名 <span class="keyword">on</span> 表名（字段名）</span><br></pre></td></tr></table></figure>

<p>（1）索引类型：</p>
<ol>
<li><p>外键索引，主键自动为主索引 （primary key）</p>
</li>
<li><p>唯一索引（unique）</p>
</li>
<li><p>普通索引（index）</p>
</li>
<li><p>全文索引（fulltext）</p>
</li>
</ol>
<p>（2）索引增删改查</p>
<ol>
<li>查询索引</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> 表名；</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>删除索引</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> index 索引名 <span class="keyword">on</span> 表名</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改索引</li>
</ol>
<p>先删除，再添加新的索引</p>
<p>（3）小结</p>
<ol>
<li><p>比较频繁的作为查询条件的字段应创建索引</p>
</li>
<li><p>更新非常频繁的字段不适合创建索引</p>
</li>
<li><p>编号出现在where子句中的字段不创建索引</p>
</li>
</ol>
</blockquote>
<h2 id="SQL优化"><a href="#SQL优化" class="headerlink" title="SQL优化"></a>SQL优化</h2><h3 id="插入数据优化"><a href="#插入数据优化" class="headerlink" title="插入数据优化"></a>插入数据优化</h3><h4 id="insert优化"><a href="#insert优化" class="headerlink" title="insert优化"></a>insert优化</h4><blockquote>
<p><strong>批量插入</strong>:一次插入500到1000条比较合适，如果数据大则分多条插入。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_name <span class="keyword">value</span>(<span class="number">1</span>, <span class="string">&#x27;tom&#x27;</span>),(<span class="number">2</span>,<span class="string">&#x27;cat&#x27;</span>),(<span class="number">3</span>,<span class="string">&#x27;ha&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>手动提交事务</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719162204673.png" alt="image-20240719162204673"></p>
<p><strong>主键顺序插入</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719162226764.png" alt="image-20240719162226764"></p>
</blockquote>
<h4 id="大批量插入数据"><a href="#大批量插入数据" class="headerlink" title="大批量插入数据"></a>大批量插入数据</h4><blockquote>
<p>如果一次性需要插入大批量数据，使用insert语句插入性能较低，此时可以使用MySQL数据库提供的load指令进行插入</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719162645535.png" alt="image-20240719162645535"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 客户端连接服务端是，加上参数 --local-infile</span></span><br><span class="line">mysql <span class="comment">--local-infile -u root -p;</span></span><br><span class="line"><span class="comment">-- 设置全局程序local_infile为1，开启从本地加载文件导入数据的开关</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> local_infile <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 执行load指令将准备好的数据，加载到表结构中</span></span><br><span class="line">load data <span class="keyword">local</span> infile <span class="string">&#x27;/root/sql.log&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> <span class="string">&#x27;表名&#x27;</span> file terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> lines terminated <span class="keyword">by</span> <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"><span class="comment">-- 解析：字段将以 &#x27;,&#x27;分割，每行数据以 &#x27;\n&#x27;分隔</span></span><br></pre></td></tr></table></figure>

<p>主键顺序插入性能高于乱序插入。</p>
</blockquote>
<h3 id="主键优化"><a href="#主键优化" class="headerlink" title="主键优化"></a>主键优化</h3><blockquote>
<p><strong>数据组织方式</strong>：在InnoDB存储引擎中，表数据都是根据主键顺序组织存放的，这种存储方式的表成为<code>索引组织表</code>(index organized table IOT)；</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719165114714.png" alt="image-20240719165114714"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719165246043.png" alt="image-20240719165246043"></p>
<p><strong>页分裂</strong>：页可以为空，也可以填充一半，也可以填充100%，每个页包含了2-N行数据(如果一行数据较大，会行溢出)，根据主键排列。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719165507103.png" alt="image-20240719165507103"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719165737906.png" alt="image-20240719165737906"></p>
<p>主键乱序插入会产生页分裂的情况。</p>
<p><strong>页合并</strong>：当删除一行记录是，实际上记录并没有被物理输出，只是记录被标记(flaged)为删除并且它的空间变得允许被其他记录声明使用。当页中删除的记录达到Merge_threshold（合并页的阈值，默认为页的50%），InnoDB会开始寻找最靠近的页(前或后)看看是否可以将两个页合并以优化空间使用。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719170144485.png" alt="image-20240719170144485"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719170210059.png" alt="image-20240719170210059"></p>
<p><strong>主键的设计原则</strong></p>
<ol>
<li>满足因为需求的情况下，尽量降低主键的长度。</li>
<li>插入数据时，尽量选择顺序插入，选择使用使用auto_increment自增主键。</li>
<li>尽量不要使用UUID做主键或是其他自然主键，如身份证号。</li>
<li>因为操作是，避免对主键的修改。</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719170500308.png" alt="image-20240719170500308"></p>
</blockquote>
<h3 id="order-by-优化"><a href="#order-by-优化" class="headerlink" title="order by 优化"></a>order by 优化</h3><blockquote>
<ul>
<li>using filesort:通过表的索引或全表扫描，读取满足条件的数据行，然后在排序缓冲区sort buffer中完成排序操作，所有表示同索引直接返回排序结果的排序都叫FileSort排序。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719171229439.png" alt="image-20240719171229439"></p>
<ul>
<li>using index：通过有序索引顺序扫描直接返回有序数据，这种情况即为using index，不需要额外排序，操作效率高。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719172318198.png" alt="image-20240719172318198"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719172710099.png" alt="image-20240719172710099"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719173149021.png" alt="image-20240719173149021"></p>
<p><strong>总结</strong></p>
<ul>
<li>根据排序字段建立合适的索引，多字段排序时，页遵循最左前缀否则</li>
<li>尽量使用覆盖索引</li>
<li>多字段排序，一个升序一个降序，此时需要注意联合索引在创建时的规则(asc，desc)</li>
<li>如果不可避免的出现filesort，大数据量排序是，可以适当增大排序缓冲区大小sort_buffer_size(默认256k),如果空间满了，则会在磁盘文件进行排序，性能低。</li>
</ul>
</blockquote>
<h3 id="group-by优化"><a href="#group-by优化" class="headerlink" title="group by优化"></a>group by优化</h3><blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719180635870.png" alt="image-20240719180635870"></p>
<ul>
<li>在分组操作是，可以使用索引来提高效率</li>
<li>分组操作是，索引的使用也是要满足最左前缀法则的。</li>
</ul>
</blockquote>
<h3 id="limit-优化"><a href="#limit-优化" class="headerlink" title="limit 优化"></a>limit 优化</h3><blockquote>
<p>一个常见问题就是limit 20000000,10,此时需要mysql排序前20000010条记录，仅仅返回20000000——20000010的记录，其他记录丢弃，查询排序的代价非常大。</p>
<p><strong>优化思路：</strong>：一般分页查询时，通过超级爱你覆盖索引能够比较好低提高性能，可以通过<code>覆盖索引加子查询</code>形式进行优化。</p>
<p>如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_sku t, (<span class="keyword">select</span> id <span class="keyword">from</span> tb_sku <span class="keyword">order</span> <span class="keyword">by</span> id limit <span class="number">20000010</span>) a <span class="keyword">where</span> t.id <span class="operator">=</span> a.id;</span><br></pre></td></tr></table></figure>

<p>通过覆盖索引的得到的一个仅有id的表，再通过子查询的形式查询。</p>
</blockquote>
<h3 id="count-优化"><a href="#count-优化" class="headerlink" title="count 优化"></a>count 优化</h3><blockquote>
<ul>
<li>MyISAM引擎把一个表的的总行数存在了磁盘上，因此count(*)的时候会直接返回这个数，效率很高。</li>
<li>InnoDB引擎在执行count(*)的时候，需要把数据一行一行地从引擎中读取出来，如果累积计数。</li>
</ul>
<p><strong>优化思路：</strong>：自己计数，(数据的插入和删除时分别计数),比较繁琐。</p>
<p>count的几种用法：</p>
<ul>
<li>count()是一个聚合函数，对于返回的结果集，一行行地判断，如果<code>count函数的参数不是null</code>，累积值加一，否则不加，最后返回累计值。</li>
<li>用法：count(*)，count(主键)，count(字段),count(1).</li>
</ul>
<p><strong>count(主键)：</strong>InnoDB引擎会遍历整张表，把每一行的主键id值都取出来，返回给服务层。服务层拿到主键后，直接按行进行累加(主键不可能为null)。</p>
<p><strong>count(字段)</strong></p>
<p>没有not null约束：InnoDB引擎会遍历整张表把每一行字段都取出来，返回给服务层，服务层判断是否为null，不为null，计数累加。</p>
<p>有not null约束：InnoDB引擎会变量整张表把每一行字段都取出来，返回给服务层，直接进行累加。</p>
<p>**count(1):**InnoDB引擎遍历整张表，但是不取值。服务层对于返回的每一行，放一个数据”1”进去，直接按行进行累加。</p>
<p>*<em>count(</em>):**InnoDB引擎并不会把全部字段取出来，而是专门做了优化，不取值，服务层直接按行进行累加。</p>
<p><code>按照效率排序的话，count(字段)&lt;count(主键id)&lt;count(1) =&lt;count(*)，索引尽量使用count( * )</code>;</p>
</blockquote>
<h3 id="update优化"><a href="#update优化" class="headerlink" title="update优化"></a>update优化</h3><blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719185002307.png" alt="image-20240719185002307"></p>
<p>InnoDB的行锁是针对索引加的锁，不是针对记录加的锁，并且该索引不能失效，否则会从<code>行锁升级为表锁</code>。如果name不是索引，则InnoDB引擎会将整张表锁住，其他事务不能对该表的数据进行修改。</p>
</blockquote>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><blockquote>
<p>视图(View)是一种虚拟存在的表。视图中的数据并不在数据库中实际操作，行和列数据来自定义视图的程序中使用的表，并且是在使用视图时动态生成的。</p>
<p>通俗的将，视图子保存了查询的SQL逻辑，不保存查询的结果。所以在创建视图的时候，主要工作就落在创建这条查询语句上。</p>
<p><strong>创建视图</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> [<span class="keyword">or</span> replace] <span class="keyword">view</span> 视图名称(列名列表) <span class="keyword">as</span> <span class="keyword">select</span>语句 [<span class="keyword">with</span> [<span class="keyword">cascaded</span><span class="operator">|</span><span class="keyword">local</span>] <span class="keyword">check</span> option]；</span><br></pre></td></tr></table></figure>

<p><strong>查询创建视图语句</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">view</span> 视图名称；</span><br></pre></td></tr></table></figure>

<p><strong>修改</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 方式一</span></span><br><span class="line"><span class="keyword">create</span> [<span class="keyword">or</span> replace] <span class="keyword">view</span> 视图名称(列名列表) <span class="keyword">as</span> <span class="keyword">select</span>语句 [<span class="keyword">with</span> [<span class="keyword">cascaded</span><span class="operator">|</span><span class="keyword">local</span>] <span class="keyword">check</span> option]；</span><br><span class="line"><span class="comment">-- 方式二</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">view</span> 视图名 <span class="keyword">as</span> <span class="keyword">select</span>语句；</span><br></pre></td></tr></table></figure>

<p><strong>删除</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> if <span class="keyword">exists</span> 视图名；</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="检查选项"><a href="#检查选项" class="headerlink" title="检查选项"></a>检查选项</h3><blockquote>
<p>当使用<code>with check option</code>子句创建视图时，mysql会通过视图检查正在更改的每个行，例如插入，更新，删除，以使其符合视图的定义。MySQL允许基于另一个视图创建视图，它还会检查依赖视图中的规则以保持一致性。为了确定检查的范围，MySQL提供了两个选项：cascaded和local，默认值为cascaded(级联)。</p>
<p><strong>cascaded:</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719204641752.png" alt="image-20240719204641752"></p>
<p><strong>local:</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719205629100.png" alt="image-20240719205629100"></p>
<p>local只将自身进行捆绑，检查自身数据，不会强制依赖的视图进行检查（若依赖的视图有检查选项就检查，反之不检查）。</p>
</blockquote>
<h3 id="视图的更新"><a href="#视图的更新" class="headerlink" title="视图的更新"></a>视图的更新</h3><blockquote>
<p>要是视图可更新，<code>视图中的行</code>与<code>基础表中的行</code>之间必须存在一对一的关系。如果视图包含以下任何影响，则该视图不可更新：</p>
<ul>
<li>聚合函数或窗口函数(sum(),min(),max(),count())等；</li>
<li>distinct</li>
<li>group by</li>
<li>having</li>
<li>union或者union all</li>
</ul>
</blockquote>
<h3 id="视图的作用"><a href="#视图的作用" class="headerlink" title="视图的作用"></a>视图的作用</h3><blockquote>
<p><strong>操作简单</strong></p>
<p>视图不仅可以简化用户对数据的理解，也可以简化它们的操作。那些被经常使用的程序可以被定义为视图，从而使得用户不必为以后的操作每次指定全部的条件。</p>
<p><strong>安全</strong></p>
<p>数据库可以授权，但不能授权到数据库特定行和特点的列上。通过视图用户只能查询和修改它们所能见到的数据。</p>
<p><strong>数据独立</strong></p>
<p>视图可帮助用户屏蔽真实表结构变化带来的影响。</p>
</blockquote>
<blockquote>
<ol>
<li><p>定义：视图是一个虚拟表，其内容头查询定义， 同真实的表一样，视图包含列，其时间来自对应的真实表。</p>
</li>
<li><p>对视图的总结</p>
<ol>
<li><p>视图是根据基表来创建的，视图是虚拟的表。</p>
</li>
<li><p>视图也有列，数据来自基表。</p>
</li>
<li><p>通过视图可以修改基表的数据。</p>
</li>
<li><p>基表的改变也会影响视图的数据。</p>
</li>
</ol>
</li>
<li><p>视图的基本使用</p>
<ul>
<li><p><code>create view 视图名 as select 语句 from 表名</code></p>
</li>
<li><p><code>alter view 视图名 as select 语句 from 表名</code></p>
</li>
<li><p><code>show create view 视图名</code></p>
</li>
<li><p><code>drop view 视图1，视图2</code></p>
</li>
</ul>
</li>
<li><p>注意</p>
</li>
</ol>
<p>视图中可以再 使用视图。</p>
</blockquote>
<h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><blockquote>
<p><code>存储过程</code>是事先经过编译并存储在数据库中一段SQL语句的集合，调用存储过程可以简化应用开发人员的很多工作，<code>减少数据在数据库和应用服务器之间的传输</code>，对于<code>提高数据处理</code>的效率是有好处的。</p>
<p>存储过程思想上就是数据库SQL语言层面的代码<code>封装</code>与<code>重用</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240719211749307.png" alt="image-20240719211749307"></p>
<p><strong>特点</strong></p>
<ul>
<li>封装，复用</li>
<li>可以接收参数，也可以返回数据</li>
<li>减少网络交互，效率提升</li>
</ul>
</blockquote>
<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><blockquote>
<p><strong>创建</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> 存储过程名称 (参数列表)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="comment">-- SQL语句</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 在命令行中，执行创建存储过程的SQL是，需要通过关键字delimiter指定SQL语句的结束符。</span></span><br></pre></td></tr></table></figure>

<p><strong>调用</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> 存储过程名 (参数)</span><br></pre></td></tr></table></figure>

<p><strong>查看</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询指定数据库的存储过程及状态信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> information_schema.poutines <span class="keyword">where</span> routine_schema <span class="operator">=</span> <span class="string">&#x27;xxx(数据库名称)&#x27;</span>；</span><br><span class="line"><span class="comment">-- 查询某个存储过程的定义</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">procedure</span> 存储过程名称；</span><br></pre></td></tr></table></figure>

<p><strong>删除</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> [if <span class="keyword">exists</span>] 存储过程名称；</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><blockquote>
<p><strong>系统变量</strong></p>
<p><code>系统变量是</code>MySQL服务器提供，不是用户定义的，属于服务器层面。分为<code>全局变量(global)</code>,<code>会话变量（session)</code>.</p>
<p>查看系统变量：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> [session<span class="operator">|</span><span class="keyword">global</span>] variables; <span class="comment">-- 查看所有系统变量</span></span><br><span class="line"><span class="keyword">show</span> [session <span class="operator">|</span> <span class="keyword">global</span>] variables <span class="keyword">like</span> <span class="string">&#x27;xxx&#x27;</span>；<span class="comment">-- 通过like模糊匹配方式查找变量</span></span><br><span class="line"><span class="keyword">select</span> @@[session <span class="operator">|</span> <span class="keyword">global</span>] 系统变量名 <span class="comment">-- 查看指定变量的值</span></span><br></pre></td></tr></table></figure>

<p>设置系统变量：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> [session <span class="operator">|</span> <span class="keyword">global</span>]系统变量名 <span class="operator">=</span> 值；</span><br><span class="line"><span class="keyword">set</span> @@[session <span class="operator">|</span> <span class="keyword">global</span>]系统变量名 <span class="operator">=</span> 值；</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li>如果没有指定session&#x2F;global，默认是session，会话变量。</li>
<li>mysql访问重新启动之后，所设置的全局参数会失效，要想不失效，可以在&#x2F;etc&#x2F;my.cnf中配置。</li>
</ul>
<p><strong>自定义变量</strong></p>
<p><code>用户定义变量</code>是永恒更具需要自己定义的变量，用户变量不用提取声明，在用的时候直接用”@变量名”使用就可以。其作用域为当前连接。</p>
<p>赋值：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="variable">@var_name</span> :<span class="operator">=</span> expr, <span class="variable">@var_name</span> :<span class="operator">=</span> expr;</span><br><span class="line"><span class="keyword">select</span>  字段名 <span class="keyword">into</span> <span class="variable">@var_name</span> <span class="keyword">from</span> 表名；</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="variable">@var_name</span>;</span><br></pre></td></tr></table></figure>

<p>注意：用户定义的变量无需对其进行声明或初始化，只不过获取到的值为null；</p>
<p><strong>局部变量</strong></p>
<p><code>局部变量</code>是根据需要定义的在局部生效的变量，访问之前，需要<code>declare声明</code>。可用做存储过程内的局部变量和输入参数，局部变量的范围是在其内声明的<code>begin...end</code>块；</p>
<p>声明：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> 变量名 变量类型[default...]</span><br></pre></td></tr></table></figure>

<p>赋值：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> 变量名 <span class="operator">=</span> 值；</span><br><span class="line"><span class="keyword">set</span> 变量名 :<span class="operator">=</span> 值；</span><br><span class="line"><span class="keyword">select</span> 字段名 <span class="keyword">into</span> 变量名 <span class="keyword">from</span> 表名；</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="流程控制语句"><a href="#流程控制语句" class="headerlink" title="流程控制语句"></a>流程控制语句</h3><blockquote>
<p><strong>if语句</strong></p>
<p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if 条件<span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">……</span><br><span class="line">elseif 条件<span class="number">2</span> <span class="keyword">then</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">...</span><br><span class="line"><span class="keyword">end</span> if;</span><br></pre></td></tr></table></figure>

<p><strong>参数</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240720135132650.png" alt="image-20240720135132650"></p>
<p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> 存储过程名称([<span class="keyword">in</span><span class="operator">/</span><span class="keyword">out</span><span class="operator">/</span><span class="keyword">inout</span> 参数名 参数类型])</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="comment">-- sql语句</span></span><br><span class="line"><span class="keyword">end</span>；</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p_score(<span class="keyword">in</span> score <span class="type">int</span>, <span class="keyword">out</span> <span class="keyword">result</span> <span class="type">varchar</span>(<span class="number">10</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">if score <span class="operator">&gt;=</span> <span class="number">85</span> <span class="keyword">then</span></span><br><span class="line"> <span class="keyword">set</span> <span class="keyword">result</span> :<span class="operator">=</span> <span class="string">&#x27;优秀&#x27;</span>;</span><br><span class="line">elseif score  <span class="operator">&gt;=</span> <span class="number">60</span> <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">set</span> <span class="keyword">result</span> :<span class="operator">=</span> <span class="string">&#x27;及格&#x27;</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">result</span> :<span class="operator">=</span> <span class="string">&#x27;不及格&#x27;</span>;</span><br><span class="line"><span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">call</span> p_score(<span class="number">85</span>, <span class="variable">@result</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@result</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> p1_score(<span class="keyword">inout</span> score <span class="keyword">double</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">set</span> score <span class="operator">=</span> score <span class="operator">*</span> <span class="number">0.5</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@score</span> <span class="operator">=</span> <span class="number">180</span>;</span><br><span class="line"><span class="keyword">call</span> p1_score(<span class="variable">@score</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@score</span>;</span><br></pre></td></tr></table></figure>

<p><strong>case</strong></p>
<p>语法1：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> case_value</span><br><span class="line">	<span class="keyword">when</span> when_value1 <span class="keyword">then</span> statement_list1</span><br><span class="line">	<span class="keyword">when</span> when_value2 <span class="keyword">then</span> statement_list2</span><br><span class="line">	<span class="keyword">else</span> statement_list</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">case</span>;</span><br></pre></td></tr></table></figure>

<p>语法2：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> </span><br><span class="line">	<span class="keyword">when</span> 查询条件<span class="number">1</span> <span class="keyword">then</span> statement_list1</span><br><span class="line">	<span class="keyword">when</span> 查询条件<span class="number">2</span> <span class="keyword">then</span> statement_list2</span><br><span class="line">	<span class="keyword">else</span> statement_list</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">case</span>;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240720141900327.png" alt="image-20240720141900327"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> judgment_month(<span class="keyword">in</span> <span class="keyword">month</span> <span class="type">int</span>, <span class="keyword">out</span> <span class="keyword">result</span> <span class="type">varchar</span>(<span class="number">10</span>))</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">case</span></span><br><span class="line">  <span class="keyword">when</span> <span class="keyword">month</span> <span class="keyword">between</span> <span class="number">1</span> <span class="keyword">and</span> <span class="number">3</span> <span class="keyword">then</span> <span class="keyword">set</span> <span class="keyword">result</span> :<span class="operator">=</span> <span class="string">&#x27;第一季度&#x27;</span>;</span><br><span class="line">  <span class="keyword">when</span> <span class="keyword">month</span> <span class="keyword">between</span> <span class="number">4</span> <span class="keyword">and</span> <span class="number">6</span> <span class="keyword">then</span> <span class="keyword">set</span> <span class="keyword">result</span> :<span class="operator">=</span> <span class="string">&#x27;第二季度&#x27;</span>;</span><br><span class="line">  <span class="keyword">when</span> <span class="keyword">month</span> <span class="keyword">between</span> <span class="number">7</span> <span class="keyword">and</span> <span class="number">9</span> <span class="keyword">then</span> <span class="keyword">set</span> <span class="keyword">result</span> :<span class="operator">=</span> <span class="string">&#x27;第三季度&#x27;</span>;</span><br><span class="line">  <span class="keyword">when</span> <span class="keyword">month</span> <span class="keyword">between</span> <span class="number">10</span> <span class="keyword">and</span> <span class="number">12</span> <span class="keyword">then</span> <span class="keyword">set</span> <span class="keyword">result</span> :<span class="operator">=</span> <span class="string">&#x27;第四季度&#x27;</span>;</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">case</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> judgment_month(<span class="number">9</span>, <span class="variable">@result</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="variable">@result</span>;</span><br></pre></td></tr></table></figure>

<p><strong>while</strong></p>
<p>while循环是有条件的循环控制语句。满足条件后，再执行循环体中SQL语句。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">while 条件 do</span><br><span class="line"><span class="keyword">SQL</span>逻辑</span><br><span class="line"><span class="keyword">end</span> while；</span><br></pre></td></tr></table></figure>

<p>累积1到n:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> get_sum(<span class="keyword">in</span> n <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> total <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">while n <span class="operator">&gt;=</span> <span class="number">1</span> do</span><br><span class="line">  <span class="keyword">set</span> total <span class="operator">=</span> total <span class="operator">+</span> n;</span><br><span class="line">  <span class="keyword">set</span> n <span class="operator">=</span> n <span class="operator">-</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">end</span> while;</span><br><span class="line"><span class="keyword">select</span> total;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> get_sum(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p><strong>repeat</strong></p>
<p>repeat 是有条件的循环控制语句，当满足条件的时候退出循环</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">repeat </span><br><span class="line"><span class="keyword">SQL</span>逻辑</span><br><span class="line">until 条件</span><br><span class="line"><span class="keyword">end</span> repeat；</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> get_sum1(<span class="keyword">in</span> n <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> total <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">repeat</span><br><span class="line">  <span class="keyword">set</span> total <span class="operator">=</span> total <span class="operator">+</span> n;</span><br><span class="line">  <span class="keyword">set</span> n <span class="operator">=</span> n <span class="operator">-</span> <span class="number">1</span>;</span><br><span class="line">  until n <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">  <span class="keyword">end</span> repeat;</span><br><span class="line"><span class="keyword">select</span> total;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> get_sum1(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p><strong>loop</strong></p>
<p>loop实现简单的循环，如果不在SQL逻辑中添加退出循环的条件，可以用其来实现简单的死循环。loop可以配合以下两个语句使用</p>
<ul>
<li>leave：配合循环使用过，退出循环</li>
<li>iterate：必须用在循环中，其作用是跳过当前循环剩下的语句，直接进入下一次循环。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[begin_label:] loop</span><br><span class="line"> 	<span class="keyword">sql</span> 逻辑</span><br><span class="line"><span class="keyword">end</span> loop [end_lable];</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> get_sum2(<span class="keyword">in</span> n <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> total <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">    flag: loop</span><br><span class="line">        <span class="keyword">set</span> total <span class="operator">=</span> total <span class="operator">+</span> n;</span><br><span class="line">        <span class="keyword">set</span> n <span class="operator">=</span> n <span class="operator">-</span> <span class="number">1</span>;</span><br><span class="line">        if n <span class="operator">=</span> <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">            leave flag ;</span><br><span class="line">        <span class="keyword">end</span> if;</span><br><span class="line">        <span class="keyword">end</span> loop flag;</span><br><span class="line">    <span class="keyword">select</span> total;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> get_sum2(<span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 累加1-n之间的偶数</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> get_evenNumber;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> get_evenNumber(<span class="keyword">in</span> n <span class="type">int</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> total <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">    flag: loop</span><br><span class="line">        if n <span class="operator">%</span> <span class="number">2</span> <span class="operator">!=</span> <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">set</span> n <span class="operator">=</span> n <span class="operator">-</span> <span class="number">1</span>;</span><br><span class="line">            iterate flag ;</span><br><span class="line">        <span class="keyword">end</span> if;</span><br><span class="line">        <span class="keyword">set</span> total <span class="operator">=</span> total <span class="operator">+</span> n;</span><br><span class="line">        <span class="keyword">set</span> n <span class="operator">=</span> n <span class="operator">-</span> <span class="number">1</span>;</span><br><span class="line">        if n <span class="operator">&lt;=</span> <span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">            leave flag;</span><br><span class="line">        <span class="keyword">end</span> if;</span><br><span class="line">        <span class="keyword">end</span> loop flag;</span><br><span class="line">    <span class="keyword">select</span> total;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">call</span> get_evenNumber(<span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<p><strong>游标</strong></p>
<p>游标(cursor)是用来存储存储程序结果集的数据类型，在存储过程和函数中可以使用游标对结果集进行循环的处理。游标的使用包括游标的声明。open，fetch，和close。</p>
<p>声明游标：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> 游标名称 <span class="keyword">cursor</span> <span class="keyword">for</span> 查询语句；</span><br></pre></td></tr></table></figure>

<p>打开游标：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> 游标名称；</span><br></pre></td></tr></table></figure>

<p>获取游标记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fetch</span> 游标名称 <span class="keyword">into</span> 变量[,变量]；</span><br></pre></td></tr></table></figure>

<p>关闭游标：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">close</span> 游标名称；</span><br></pre></td></tr></table></figure>

<p><strong>条件处理程序</strong></p>
<p>条件处理程序可以用来定义在流程控制结构执行过程中遇到问题是相应的处理步骤。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 当游标中的数据为空时，关闭游标并退出</span></span><br><span class="line"><span class="keyword">declare</span> </span><br><span class="line">	exit</span><br><span class="line">handler </span><br><span class="line">	<span class="keyword">for</span> <span class="keyword">sqlstate</span> <span class="string">&#x27;02000&#x27;</span> </span><br><span class="line"><span class="keyword">close</span> <span class="keyword">cursor</span>名称；</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="存储函数"><a href="#存储函数" class="headerlink" title="存储函数"></a>存储函数</h3><blockquote>
<p>存储函数是有<code>返回值</code>的存储过程，存储函数的参数只能是in类型。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240720183336043.png" alt="image-20240720183336043"></p>
<p>计算从1累加到n的值，n为传入的参数值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> fun1( n <span class="type">int</span>)</span><br><span class="line"><span class="keyword">returns</span> <span class="type">int</span> <span class="keyword">deterministic</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> total <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">while n <span class="operator">&gt;</span> <span class="number">0</span> do</span><br><span class="line"><span class="keyword">set</span> total :<span class="operator">=</span> total <span class="operator">+</span> n;</span><br><span class="line"><span class="keyword">set</span> n :<span class="operator">=</span> n <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">end</span> while;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> total;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">select</span> fun1(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><h3 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h3><blockquote>
<p>触发器是与表有关的数据库对象，值在<code>insert/update/delete</code>之前或之后，重复并执行触发器中定义的SQL语句集合。触发器的这种特性可以协助应用在数据库端确保<code>数据的完整性</code>，<code>日志记录</code>，<code>数据校验</code>等操作。</p>
<p>使用别名<code>old</code>和<code>new</code>来引用触发器中发生变化的记录内容，这与其他的数据库是相似的。现在触发器还只支持<code>行级触发</code>，不支持语句级触发。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240720184513085.png" alt="image-20240720184513085"></p>
</blockquote>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><blockquote>
<p><strong>创建</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trigger_name</span><br><span class="line">before<span class="operator">/</span>after <span class="keyword">insert</span><span class="operator">/</span><span class="keyword">update</span><span class="operator">/</span><span class="keyword">delete</span></span><br><span class="line"><span class="keyword">on</span> table_name <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span> <span class="comment">-- 行级触发器</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">SQL</span>逻辑；</span><br><span class="line"><span class="keyword">end</span>；</span><br></pre></td></tr></table></figure>

<p><strong>查看</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> triggers;</span><br></pre></td></tr></table></figure>

<p><strong>删除</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> [schema_name] trigger_name;</span><br><span class="line"><span class="comment">-- 如果没有指定schema_name，默认为当前数据库。</span></span><br></pre></td></tr></table></figure>

<p>添加数据的触发器：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240720185955911.png" alt="image-20240720185955911"></p>
<p>修改数据的触发器：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240720190506003.png" alt="image-20240720190506003"></p>
<p>删除数据的触发器：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240720190902436.png" alt="image-20240720190902436"></p>
</blockquote>
<h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><h3 id="介绍-3"><a href="#介绍-3" class="headerlink" title="介绍"></a>介绍</h3><blockquote>
<p>锁是计算机协调多个进程或线程并发访问某一资源的机制。在数据库中，除传统的计算资源(cpu,ram，IO)的争用以外，数据也是一种供许多用户共享的资源。然后保证数据并发访问的<code>一致性</code>，有效性是所有数据库必须解决的一个问题，锁冲突也是影响数据库<code>并发</code>访问性能的一个重要因素。</p>
<p><strong>分类</strong></p>
<p>MySQL中的锁，按照锁的粒度分，分为三类：</p>
<ul>
<li>全局锁：锁定数据库中的所有表。</li>
<li>表级锁：每次操作锁住整张表</li>
<li>行级锁：每次操作锁住对应的行数据。</li>
</ul>
</blockquote>
<h3 id="全局锁"><a href="#全局锁" class="headerlink" title="全局锁"></a>全局锁</h3><blockquote>
<p>全局锁就是对整个数据库实例加锁，加锁后整个实例处于只读状态，后续的DML的写语句，DDL语句，已经更新操作的事务提交语句都将被阻塞。</p>
<p>其典型的使用场景就是做全库的<code>逻辑备份</code>，对所有的表进行锁定，从而获取一致性视图，保证数据的完整性。</p>
<p>加锁前：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240720213824672.png" alt="image-20240720213824672"></p>
<p>加锁后：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240720214113460.png" alt="image-20240720214113460"></p>
<p>添加全局锁：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush tables <span class="keyword">with</span> read lock;</span><br></pre></td></tr></table></figure>

<p>备份数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="operator">-</span>u root <span class="operator">-</span> p123 数据库名<span class="operator">&gt;</span>xxx.sql</span><br></pre></td></tr></table></figure>

<p>解除锁：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unlock tables;</span><br></pre></td></tr></table></figure>

<p><strong>特点</strong></p>
<p>数据库中加全局锁，是一个比较重的操作，存在以下问题：</p>
<ol>
<li>如果在主库上备份，那么在备份期间都不能执行更新，业务基本上就得停摆；</li>
<li>如果在从库上备份，那么在备份期间从库不能执行主库同步管理的二进制日志(binlog)，会导致主从延迟。</li>
</ol>
<p>在InnoDB引擎中，我们可以在备份时加上参数<code>--sigle-transaction</code>参数来完成不加锁的一致性数据备份。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump <span class="literal">--single-transaction</span> <span class="literal">-uroot</span> <span class="literal">-pxxx</span> 数据库名&gt; xxx.sql;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="表级锁"><a href="#表级锁" class="headerlink" title="表级锁"></a>表级锁</h3><blockquote>
<p>表级锁，每次操作锁住整张表。锁定粒度大，发生锁冲突的概率最高，并发度最低。应用在MyISAM。InnoDB，BDB等存储引擎中。</p>
<p>对于表级锁，主要分为以下三类：</p>
<ul>
<li>表锁</li>
<li>元数据锁(meta data lock)</li>
<li>意向锁</li>
</ul>
</blockquote>
<h4 id="表锁"><a href="#表锁" class="headerlink" title="表锁"></a>表锁</h4><blockquote>
<ul>
<li>表共享读锁(read lock)</li>
<li>表独享锁(write lock)</li>
</ul>
<p>语法：</p>
<p>加锁：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lock tables 表名... read<span class="operator">/</span>write</span><br></pre></td></tr></table></figure>

<p>释放锁：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unlock tables<span class="operator">/</span>客户端断开连接</span><br></pre></td></tr></table></figure>

<p>读锁不会阻塞其他客户端的读，但是会阻塞写。写锁既会阻塞其他客户端的读，又会阻塞其他客户端的写。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240720223148884.png" alt="image-20240720223148884"></p>
</blockquote>
<h4 id="元数据锁-meta-data-lock，MDL"><a href="#元数据锁-meta-data-lock，MDL" class="headerlink" title="元数据锁(meta data lock，MDL)"></a>元数据锁(meta data lock，MDL)</h4><blockquote>
<p>MDL加锁过程是系统自动控制，无需显示使用，在访问一张表的时候会自动加上。MDL锁主要作用是维护元数据的数据一致性，在表上有活动事务的时候，不可以对元数据进行写入操作。<code>为了避免DDL（‌数据定义语言）‌与DDL(数据操作语言)冲突，保证读写的正确性。</code></p>
<p>在MySQL5.5中引入了MDL，当对一张表进行增删改查的时候，加MDL读锁(共享)；当对表结构进行变更操作的时候，加MDL写锁(排他)。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240720224042939.png" alt="image-20240720224042939"></p>
<p>查看元数据锁：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> object_type,object_schema,lock_duration <span class="keyword">from</span> performance_schema.metadata_locks;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="意向锁"><a href="#意向锁" class="headerlink" title="意向锁"></a>意向锁</h4><blockquote>
<p>为了避免DML在执行时，<code>加的行锁与表锁的冲突</code>，在InnoDB中引入了意向锁，使得表锁不用检查每一行数据是否加锁，使用意向锁来减少表锁的检查。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240720230104550.png" alt="image-20240720230104550"></p>
<p>意向共享锁(IS)：</p>
<ul>
<li>由语句<code>select...lock in share mode</code>；添加</li>
<li>与表锁共享锁(read)兼容，与表锁排他锁(write)互斥</li>
</ul>
<p>意向排他锁(IX)：</p>
<ul>
<li>由<code>insert，update，delete，select...from update</code>添加</li>
<li>与表锁共享锁(read)及排它锁(write)都互斥。意向锁之间不会互斥。</li>
</ul>
<p>查看意向锁机行锁的加锁情况</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> object_type,object_schema,lock_duration <span class="keyword">from</span> performance_schema.data_locks;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="行级锁"><a href="#行级锁" class="headerlink" title="行级锁"></a>行级锁</h3><blockquote>
<p>行级锁，每次操作锁住对应的行数据。锁定粒度最小，发生锁冲突的概率最低，并发度最高。应用在InnoDB存储引擎中。</p>
<p>InnoDB的数据是基于索引组织的，行锁时通过对索引上的索引项加锁来实现的，而不是对记录加的锁。对于行级锁，主要分为以下三类：</p>
<ul>
<li>行锁(Record Lock):锁定单个行记录的锁，防止其他事务对此进行update和delete。在RC，RR隔离级别下都支持。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240720232645588.png" alt="image-20240720232645588"></p>
<ul>
<li>间隙锁(Gap Lock)：锁定索引记录间隙(不含该记录)，确保索引记录间隙不变，赋值其他事务在这个间隙进行insert，产生幻读。在RR隔离级别下都支持。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240720232624888.png" alt="image-20240720232624888"></p>
<ul>
<li>临键锁(next-key Lock):行锁和间隙锁组合，同时锁住数据，并锁住数据前面的间隙gap。在RR隔离级别下支持。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240720232557999.png" alt="image-20240720232557999"></p>
</blockquote>
<h4 id="行锁"><a href="#行锁" class="headerlink" title="行锁"></a>行锁</h4><blockquote>
<p>InnoDB实现了两种类型的行锁：</p>
<ul>
<li>共享锁(S):允许一个事务去读一行，阻止其他事务获得相同的数据集的排它锁。</li>
<li>排它锁(X):允许获取排它锁的事务更新数据，阻止其他事务获得相同数据记得共享锁和排它锁。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721123206077.png" alt="image-20240721123206077"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721123800548.png" alt="image-20240721123800548"></p>
<p>默认情况下，InnoDB在<code>repeatable read</code>事务隔离级别运行，InnoDB使用<code>next-key</code>锁进行搜索和索引扫描，以防止幻读。</p>
<ol>
<li>针对唯一索引进行检索式，对已存在的记录进行等值匹配时，将会自动优化为行锁。</li>
<li>InnoDB的行锁是针对于索引加的锁，不通过索引条件检索数据，那么InnoDB将对表中的所有记录加锁，此时就会升级为表锁。</li>
</ol>
<p>查看意向锁机行锁的加锁情况：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> object_schema,object_name,index_name,lock_type,lock_mode,lock_data <span class="keyword">from</span> performance_schema.data_locks;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="间隙锁-临键锁"><a href="#间隙锁-临键锁" class="headerlink" title="间隙锁&#x2F;临键锁"></a>间隙锁&#x2F;临键锁</h4><blockquote>
<p>默认情况下，InnoDB在<code>repeatable read</code>事务隔离级别运行，InnoDB使用<code>next-key</code>锁进行搜索和索引扫描，以防止幻读。</p>
<ul>
<li>索引上的等值查询(唯一索引)，给不存在的记录加锁时，优化为间隙锁。</li>
<li>索引上等值查询(普通索引)，向右遍历是最后一个值不满足查询需求时，<code>next-key lock</code>退化为<code>间隙锁</code>。</li>
<li>索引上的范围查询(唯一索引),会访问到不满足条件的第一个值为止。</li>
</ul>
<p>注意：间隙锁唯一的目的是防止其他事务插入间隙。间隙锁可以共存，一个事务采用的间隙锁不会阻止另一个事务在同一间隙上采用间隙锁。</p>
</blockquote>
<h2 id="InnoDB引擎"><a href="#InnoDB引擎" class="headerlink" title="InnoDB引擎"></a>InnoDB引擎</h2><h3 id="逻辑存储结构"><a href="#逻辑存储结构" class="headerlink" title="逻辑存储结构"></a>逻辑存储结构</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721132546358.png"></p>
<h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><blockquote>
<p>MySQL5.5版本开始，默认使用InnoDB存储引擎，它擅长事务处理，具有恢复特性，在日常开发中使用非常广泛。下面是InnoDB架构图，左侧为内存结构，右侧为磁盘结构。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721132801035.png" alt="image-20240721132801035"></p>
<p><strong>内存架构</strong></p>
<p><code>Buffer Pool</code>：缓冲池是主内存中一个区域，里面可以缓存磁盘上进程操作的真实数据，在执行增删改查操作是，先操作缓冲池中的数据(若缓冲池没有数据，则从磁盘加载并缓存)，然后在意一定频率刷新到磁盘，从而减少IO，加快处理速度。</p>
<p>缓冲池以Page页为单位，底层采用<code>链表数据结构</code>管理Page.根据状态，将Page分为三种类型：</p>
<ul>
<li>free Page：空闲Page，未被使用。</li>
<li>clean Page：被使用Page，数据没有被修改过。</li>
<li>dirty Page：脏页，被使用Page，数据被修改过，而且数据域磁盘的数据产生了不一致。</li>
</ul>
<p><code>Change Buffer</code>：更改缓冲区(针对于<code>非唯一二级索引页</code>)，在执行DML语句是，如果这些数据Page没有在Buffer Pool中，不会直接操作磁盘，而会将数据变更操作更改缓冲区Change Buffer中，在未来数据被读取时，再将数据合并恢复到Buffer Pool中，再将合并后的数据刷新到磁盘中。</p>
<p><code>Change Buffer</code>的意义是什么？</p>
<p>与聚集索引不同，二级索引通常是非唯一的，并且以相对随机的顺序插入二级索引。同样，删除和更新可能会影响索引树中不相邻的二级索引页，如果每一次都操作磁盘，会造成大量的磁盘IO。有了Change Buffer之后，我们可以在缓冲池中进行合并处理。</p>
<p><code>Adaptive Hash Index</code>:自适应Hash索引，用于优化对Buffer Pool数据的查询。InnoDB存储引擎会监控对表上各索引页的查询，如果观察到Hash索引可以提升速度，则建立Hash索引，称之为自适应Hash索引。</p>
<p><code>自适应哈希索引，无需人工干预，是系统根据情况自动完成</code>。</p>
<p>参数：adaptive_hash_index</p>
<p><code>Log Buffer</code>:日志缓冲区，用来保存要写入到磁盘中的log日志数据(redo log,undo log)，默认大小为16MB，日志缓冲区的日志会定期刷新到磁盘中。如果需要更新插入或删除许多行的事务，增加日志缓冲区的大小可以节省磁盘IO、</p>
<p>参数：</p>
<ul>
<li>InnoDB_log_buffer_size:缓冲区大小</li>
<li>InnoDB_flush_log_at_trx_commit:日志刷新到磁盘时机</li>
<li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721135810690.png" alt="image-20240721135810690"></li>
</ul>
<p><strong>磁盘结构</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721140147198.png" alt="image-20240721140147198"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721140602054.png" alt="image-20240721140602054"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721140731017.png" alt="image-20240721140731017"></p>
<p><strong>后台线程</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721145815284.png" alt="image-20240721145815284"></p>
<ol>
<li><code>master Thread</code></li>
</ol>
<p>核心后台线程，负责调度其他线程，还负责将缓冲池的数据异步刷新到磁盘中，保存数据的一致性，还包括脏页的刷新，合并插入缓存，undo页的回收。</p>
<ol start="2">
<li><code>IO Thread</code></li>
</ol>
<p>在InnoDB存储引擎中大量使用了AIO(异步IO)来处理IO请求，这样可以极大地提高了数据库的性能，而IO Thread主要负责这些IO请求的回调。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721150211592.png" alt="image-20240721150211592"></p>
<ol start="3">
<li><code>Purge Thread</code></li>
</ol>
<p>主要用于回收事务已经提交了的undo log，在事务提交之后，undo log可能不用了，就用它来回收。</p>
<ol start="4">
<li><code>Page Cleaner Thread</code></li>
</ol>
<p>协助Master Thread刷新脏页到磁盘的线程，它可以减轻Master Thread的工作压力，减少阻塞。</p>
</blockquote>
<h3 id="事务原理"><a href="#事务原理" class="headerlink" title="事务原理"></a>事务原理</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721150946619.png" alt="image-20240721150946619"></p>
<blockquote>
<p><strong>redo log——持久性</strong></p>
<p><code>重做日志</code>，记录的是<code>事务提交时</code>数据页的物理修改，是用来实现事务的持久性。</p>
<p>该日志文件有两部分组成：<code>重做日志缓冲(redo log buffer)</code>以及<code>重做日志文件(redo log file)</code>,前者是在<code>内存</code>中，后者在<code>磁盘</code>中。当事务提交之后会把所有修改信息都存到改日志文件中，用于在刷新脏页到磁盘，发生错误事，进行数据恢复使用。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721152037374.png" alt="image-20240721152037374"></p>
<p><strong>undo log——原子性</strong></p>
<p><code>回滚日志</code>，用于记录数据被修改前的信息，作用包含两个：提供回滚和MVCC(多版本并发控制)。</p>
<p>undo log和redo log记录物理日志不一样，它是逻辑日志。可以认为当delete一条记录是，undo log中记录一条对应的insert记录，反之亦然，当update一条记录是，它记录一条对应相反的update记录(修改前的记录)。当执行rollback是，就可以从undo log中的逻辑记录读取到相应的内容并进行回滚。</p>
<p><code>Undo log销毁</code>：undo log在事务执行时产生，事务提交时，并不会立即删除undo  log，因为这些日志可能回用于MVCC。</p>
<p><code>Undo log存储</code>：undo log采用段的方式进行管理和记录，存放在前面介绍的rollback segment 回滚段中，内部包含1024个undo log segment。</p>
<p><strong>undo log+redo log —— 一致性</strong></p>
<p><strong>锁 + MVCC —— 隔离性</strong></p>
</blockquote>
<h3 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h3><blockquote>
<p><strong>当前读</strong></p>
<p>读取的是<code>记录的最新版本</code>，读取是还要保证其他并发事务不能修改当前记录，会对读取的记录进行加锁。对于我们日常的操作，如：<code>select……lock in share mode(共享锁)</code>，<code>select...for update</code>、update、insert、delete(排它锁)都是一种当前读。</p>
<p><strong>快照读</strong></p>
<p>简单的select(不加锁)就是快照读，快照读，读取的是记录数据的可见版本，有可能是历史数据，不加锁，是非阻塞读。</p>
<ul>
<li>read Commited:每次select，都删除一个快照读。</li>
<li>repeatable read：开启事务后第一个select语句才是快照读的地方。</li>
<li>serializable：快照读会退化为当前读。</li>
</ul>
<p><strong>MVCC</strong></p>
<p>全称Multi-Version Concurrency Control,多版本并发控制。指维护一个数据的多个版本，使得读写操作没有冲突，快照读为MySQL实现MVCC提供了一个非阻塞读功能。MVCC的具体实现，还需要依赖于数据库三个组件 —— <code>记录中三个隐式字段</code>，<code>undo log版本链</code>，<code>readView</code>。</p>
</blockquote>
<h4 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721165254445.png" alt="image-20240721165254445"></p>
<blockquote>
<p><strong>记录中的隐藏字段</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721161749803.png" alt="image-20240721161749803"></p>
<p><strong>undo log</strong></p>
<p>回滚日志，在insert，update，delete的时候产生的便于数据回滚的日志。</p>
<p>当insert的时候，产生的undo log日志只在回滚是需要，在事务提交后，可被逻辑删除。</p>
<p>而update，delete的时候，产生的undo log日志不仅在回滚是需要，在快照读时也需要，不会立即被删除。</p>
<p><strong>undo log版本链</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721162608295.png" alt="image-20240721162608295"></p>
<p>不同事务或相同事务对同一条记录进行修改，会导致该记录的undolog生成一条记录版本链表，链表的头部是最新的就记录，链表尾部是最早的旧记录。</p>
<p><strong>readview</strong></p>
<p>readview(读视图)是快照读SQL执行时MVCC提取数据的依据，记录并维护系统当前活跃的事务(为提交的)id。</p>
<p>readView中包含了四个核心字段：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721163435603.png" alt="image-20240721163435603"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721163741850.png" alt="image-20240721163741850"></p>
<p>不同的隔离级别，生成readView的时机不同：</p>
<ul>
<li>read committed：在事务中每一次执行快照读时生成readView。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721164914830.png" alt="image-20240721164914830"></p>
<ul>
<li>repeatable read：仅在事务中第一次执行快照读生成readView，后续复用该readView。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721165129909.png" alt="image-20240721165129909"></p>
</blockquote>
<h2 id="MySQL管理"><a href="#MySQL管理" class="headerlink" title="MySQL管理"></a>MySQL管理</h2><h3 id="系统数据库"><a href="#系统数据库" class="headerlink" title="系统数据库"></a>系统数据库</h3><blockquote>
<p>MySQL数据库安装后，自带了四个数据库：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721205717937.png" alt="image-20240721205717937"></p>
</blockquote>
<h3 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h3><blockquote>
<p><strong>mysql:</strong></p>
<p>该MySQL表示值MySQL服务，而是指MySQL的<code>客户端工具。</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721205829144.png" alt="image-20240721205829144"></p>
<p>-e选项可以在MySQL客户端执行SQL语句而<code>不用连接到MySQL数据库</code>再执行，对于一些批处理脚本，这种方式尤其方便。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721205941236.png" alt="image-20240721205941236"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql  <span class="operator">-</span>uroot <span class="operator">-</span>p025336 mybook <span class="operator">-</span>e&quot;select * from books&quot; </span><br></pre></td></tr></table></figure>

<p><strong>mysqladmin</strong></p>
<p>mysqladmin是一个执行管理操作的客户端程序。可以用它来检查<code>服务器的配置</code>和<code>当前状态</code>,创建并删除数据库等。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721211227649.png" alt="image-20240721211227649"></p>
<p><strong>mysqlbinlog</strong></p>
<p>由于服务器生成的<code>二进制日志</code>文件以二进制格式保存，所以如果想要检查这些文本的文本格式，就会使用到mysqlbinlog日志管理工具。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721211353574.png" alt="image-20240721211353574"></p>
<p><strong>mysqlshow</strong></p>
<p>mysqlshow客户端对象查找工具，用来很快查找存在哪些数据库，数据库中表，表中的列或索引。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721211816835.png" alt="image-20240721211816835"></p>
<p><strong>mysqldump</strong></p>
<p>mysqldump客户端工具用来备份数据库或在不同数据库组件进行数据迁移。备份内容包含创建表，及插入表的SQL语句。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240721212413759.png" alt="image-20240721212413759"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#备份库的表</span></span><br><span class="line">mysqldump <span class="literal">-u</span> 用户名 <span class="literal">-p</span> 密码 数据库 表<span class="number">1</span>，表<span class="number">2</span> &gt; d://文件名.sql</span><br></pre></td></tr></table></figure>

<p><strong>mysqlimport&#x2F;source</strong></p>
<p>mysqlimport 是客户端数据导入工具，用来导入mysqldump加-T参数后导出的文本文件。</p>
<p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqlimport [option] db_name textfile1 [textfile2...];</span><br><span class="line"><span class="comment">-- 示例</span></span><br><span class="line">mysqlimport <span class="operator">-</span>uroot <span class="operator">-</span>pxxx xxx<span class="operator">/</span>xxx.txt;</span><br></pre></td></tr></table></figure>

<p>如果需要导入sql文件，使用source指令；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#恢复数据库</span><br><span class="line">source 文件名.<span class="keyword">sql</span> </span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>（1）创建用户</p>
<p><code>create user ‘用户名’@ ‘允许登录的位置’ identified by ‘密码’</code></p>
<p>声明：创建用户的同时指定密码。</p>
<p>（2）删除用户</p>
<p><code>drop user ‘用户名’ @ ‘允许登录位置’</code></p>
<p>（3）用户修改密码</p>
<ol>
<li>修改自己的密码</li>
</ol>
<p><code>set password = password（‘密码’）</code></p>
<ol start="2">
<li>修改他人的密码</li>
</ol>
<p><code>set password for ‘用户名’ @ ‘允许登录位置’ = password（‘密码’）</code></p>
<p>（4）给用户授权</p>
<p>基本语法：<code>grant 权限列表 on 库.对象名 to ‘用户名’ @ ‘登录位置’（identified by ‘密码’）</code></p>
<p>（5）权限列表，多个权限用逗号隔开</p>
<ol>
<li><p><code>grant select on...</code></p>
</li>
<li><p><code>grant seleclt , delete , create on...</code></p>
</li>
<li><p><code>grant all on...</code></p>
</li>
</ol>
<p>（6）特别声明</p>
<p><em>.</em>:代表本系统中所有数据库的所有对象（表，视图）</p>
<p>库.*：表示某个数据库中的所有对象（表，视图）</p>
<p>（7）identified by 可以省略，可以写出</p>
<p>①如果用户存在，就是修改用户密码</p>
<p>②如果用户不存在，就是创建该用户</p>
<p>（8）回收用户授权</p>
<p>①基本语法： revoke 权限列表 on 库.对象名 from ‘用户名’@ ‘登录位置’</p>
<p>②权限生效指令：如何权限没有生效，执行flush privileges；</p>
<p>（9）细节声明</p>
<p>①创建用户的时候，如果不指定host，则为%，%表示所有ip都有连接权限</p>
<p>②可以指定：create user ‘xxx’@ “192.168.%”表示用户在192.168.的IP可以登录mysql</p>
<p>③在删除用户的时候，如果host表示%，需要明确指定‘用户’@ ‘host值’</p>
</blockquote>
<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><h3 id="错误日志"><a href="#错误日志" class="headerlink" title="错误日志"></a>错误日志</h3><blockquote>
<p>错误日志是MySQL中最重要的日志之一，它记录了当mysqld启动和停止时，以及服务器在运行过程中发生任何严重错误事的相关信息。当数据库出现任何故障导致无法正常使用时，建议首先查看此日志。</p>
<p>该日志是默认开启的，默认存放目录&#x2F;var&#x2F;log&#x2F;，默认的日志文件名为mysqld.log。查看日志位置：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> &quot;log_error%&quot;；</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="二级制日志"><a href="#二级制日志" class="headerlink" title="二级制日志"></a><strong>二级制日志</strong></h3><blockquote>
<p><strong>介绍</strong></p>
<p>二进制日志(binlog)记录了所有的<code>DDL(数据定义语言)语句</code>和<code>DML(数据操纵语言)语句</code>，但不包含数据查询(select,show)语句。</p>
<p>作用：</p>
<ol>
<li>灾难时的数据恢复；</li>
<li>mysql的主从复制。</li>
</ol>
<p>在mysql8版本中，默认二级制日志是开启着的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%log_bin%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722170444802.png" alt="image-20240722170444802"></p>
<p><strong>日志格式</strong></p>
<p>MySQL服务器中提供了多种格式来记录二进制日志，具体格式及特点如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722170628385.png" alt="image-20240722170628385"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%binlog_format%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>日志查看</strong></p>
<p>由于日志是以二进制方式存储的，不能直接读取，需要通过二进制日志查询工具mysqlbinlog来查看.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722170938266.png" alt="image-20240722170938266"></p>
<p><strong>日志删除</strong></p>
<p>对于比较繁忙的业务系统，每天生成的binlog数据巨大，如果长时间不清除，将会占用大量磁盘空间。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722171842658.png" alt="image-20240722171842658"></p>
<p>也可以在MySQL的配置文件中配置二进制的过期时间，设置了之后，二进制日志过期会自动删除。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%binlog_expire_logs_seconds%&#x27;</span>；</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="查询日志"><a href="#查询日志" class="headerlink" title="查询日志"></a>查询日志</h3><blockquote>
<p>查询日志中记录了客户端的所有操作语句，而二进制日志不包含查询数据的SQL语句。默认情况下，查询日志是未开启的。如果需要开启查询日志：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722172449994.png" alt="image-20240722172449994"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%general%&#x27;</span>；</span><br></pre></td></tr></table></figure>

<p>修改MySQL的配置文件’&#x2F;etc&#x2F;my.cnf文件’，添加如下内容：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722172821669.png" alt="image-20240722172821669"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722172651956.png" alt="image-20240722172651956"></p>
</blockquote>
<h3 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a><strong>慢查询日志</strong></h3><blockquote>
<p>慢查询日志记录了所有执行时间超过参数long_query_time设置值并且扫描数不小于min_examined_row_limit的所有的SQL语句的日志，默认未开启。long_query_time默认为10秒，最小为0，精度可以到微秒.</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722173136984.png" alt="image-20240722173136984"></p>
<p>默认情况下，不会记录管理语句，也不会记录不使用索引进行查找的查询。可以使用log_slow_admin_statements和更改此行为log_queries_not_using_indexes。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722174026470.png" alt="image-20240722174026470"></p>
</blockquote>
<h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><blockquote>
<p>主从复制时指将主数据库的DDL和DML操作通过二进制日志传到从库服务器中，然后在从库对这些日志重新执行(也叫重做)，从而使得从库和主库的数据保存同步。</p>
<p>MySQL支持一台主库同时向多台从库进行复制，从库同时也可以作为其他服务器的主库，实现链状复制。</p>
<p>MySQL复制的优点主要包含以下三个方面：</p>
<ol>
<li>主库出现问题，可以快速切换到从库提供服务。</li>
<li>实现读写分离，降低主库的访问压力，增删改走主库，查询走从库。</li>
<li>可以在从库中执行备份，以避免备份期间影响主库服务。</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722175122776.png" alt="image-20240722175122776"></p>
</blockquote>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><blockquote>
<p>MySQL的主从复制原理：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722175453393.png" alt="image-20240722175453393"></p>
<p>复制过程分成三步：</p>
<ol>
<li>Master主库在事务提交时，会把数据变更记录在二进制日志文件binlog中。</li>
<li>从库读取主库的二进制日志文件binlog，写入到从库的中继日志Relay Log。</li>
<li>slave重做中继日志中的事件，将改变反映它自己的数据。</li>
</ol>
</blockquote>
<h3 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h3><blockquote>
<p><strong>服务器准备</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722175830743.png" alt="image-20240722175830743"></p>
<p><strong>主库配置</strong></p>
<ol>
<li>修改配置文件&#x2F;etc&#x2F;my.cnf</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722180012393.png" alt="image-20240722180012393"></p>
<ol start="2">
<li>重启MySQL服务器</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>登录MySQL，创建远程连接账号，并授予主从复制权限</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722180305175.png" alt="image-20240722180305175"></p>
<ol start="4">
<li>通过指令，查看二进制日志坐标</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> master status;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722180526783.png" alt="image-20240722180526783"></p>
<p><strong>从库配置</strong></p>
<ol>
<li>修改配置文件&#x2F;etc&#x2F;my.cnf</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722180637795.png" alt="image-20240722180637795"></p>
<ol start="2">
<li>重启MySQL服务器</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>登录MySQL，设置主库配置8.0.23版本</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">change replication source <span class="keyword">to</span> source_host <span class="operator">=</span> <span class="string">&#x27;xxx.xxx.xxx.xx&#x27;</span>,source_user<span class="operator">=</span><span class="string">&#x27;xxx&#x27;</span>,source_password<span class="operator">=</span><span class="string">&#x27;xxx&#x27;</span>,source_log_file<span class="operator">=</span><span class="string">&#x27;xxx&#x27;</span>,source_log_pos<span class="operator">=</span><span class="string">&#x27;xxx&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>8.0.23版本以前</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">change master  <span class="keyword">to</span> master_host <span class="operator">=</span> <span class="string">&#x27;xxx.xxx.xxx.xx&#x27;</span>,master_user<span class="operator">=</span><span class="string">&#x27;xxx&#x27;</span>,master_password<span class="operator">=</span><span class="string">&#x27;xxx&#x27;</span>,master_log_file<span class="operator">=</span><span class="string">&#x27;xxx&#x27;</span>,master_log_pos<span class="operator">=</span><span class="string">&#x27;xxx&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722181426503.png" alt="image-20240722181426503"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722181527532.png" alt="image-20240722181527532"></p>
<ol start="4">
<li>开启同步操作</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">8.0</span><span class="number">.22</span>之后</span><br><span class="line"><span class="keyword">start</span> replica；</span><br><span class="line"># 之前</span><br><span class="line"><span class="keyword">start</span> slave；</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>查看主从同步状态</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">8.0</span><span class="number">.22</span>之后</span><br><span class="line"><span class="keyword">show</span> replica status;</span><br><span class="line"># 之前</span><br><span class="line"><span class="keyword">show</span> slave status;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722181849437.png" alt="image-20240722181849437"></p>
<p><strong>测试</strong></p>
</blockquote>
<h2 id="分库分表"><a href="#分库分表" class="headerlink" title="分库分表"></a>分库分表</h2><h3 id="介绍-4"><a href="#介绍-4" class="headerlink" title="介绍"></a>介绍</h3><blockquote>
<p><strong>问题分析</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722202615153.png" alt="image-20240722202615153"></p>
<p>随着互联网及移动互联网的发展，应用系统的数据量也是成指数式增长，若采用单数据库进行数据存储，存在以下性能瓶颈：</p>
<ul>
<li>IO瓶颈：热点数据太多，数据库缓存不足，产生大量磁盘IO，效率较低。请求数据太多，带宽不够，网络IO瓶颈。</li>
<li>CPU瓶颈：排序，分组，连接查询，聚合统计等SQL会耗费大量的CPU资源，请求数太多，CPU出现瓶颈。</li>
</ul>
<p>分库分表的中心思想是将数据分散存储，使得单一数据库&#x2F;表的数据量变小来缓解单一数据库的性能问题，从而达到提升数据库性能的目的。</p>
</blockquote>
<h3 id="拆分策略"><a href="#拆分策略" class="headerlink" title="拆分策略"></a>拆分策略</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722203149788.png" alt="image-20240722203149788"></p>
<blockquote>
<p><strong>垂直拆分</strong></p>
<p>垂直分库：以表为依据，根据业务将不同表拆分到不同库中。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722203503125.png" alt="image-20240722203503125"></p>
<p>特点：</p>
<ul>
<li>每个库的表的结构都不一样。</li>
<li>每个库的数据干不也一样。</li>
<li>所有库的并集是全量数据。</li>
</ul>
<p>垂直分表：以字段为依据，根据字段属性将不同字段拆分到不同表中。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722203640724.png" alt="image-20240722203640724"></p>
<p>特点：</p>
<ul>
<li>每个表的结果都不一样</li>
<li>每个表的数据也不一样，一般通过一列(主键&#x2F;外键)关联。</li>
<li>所有表的并集是全量数据。</li>
</ul>
<p><strong>水平拆分</strong></p>
<p>水平分库：以字段为依据，按照一定策略，将一个库的数据拆分到多个库中。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722203914261.png" alt="image-20240722203914261"></p>
<p>特点：</p>
<ul>
<li>每个库的表结构都一样</li>
<li>每个库的数据都不一样</li>
<li>所有库的并集是全量数据。</li>
</ul>
<p>水平分表：以字段为依据，按照一定策略，将一个表的数据拆分到多个表中。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722204053629.png" alt="image-20240722204053629"></p>
<p>特点：</p>
<ul>
<li><p>每个表的表结构都一样</p>
</li>
<li><p>每个表的数据都不一样</p>
</li>
<li><p>所有表的并集是全量数据</p>
</li>
</ul>
<p><strong>实现技术</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722204428625.png" alt="image-20240722204428625"></p>
<ul>
<li>shardingJDBC：基于AOP原理，在应用程序中对本地执行的SQL进行拦截，解析，改写，路由处理。需要自行编码配置实现，只支持java语言，性能较高。</li>
<li>MyCat：数据库分库分表中间件，不用调整代码即可实现分库分表，支持多种语言，性能不及前者。</li>
</ul>
</blockquote>
<h3 id="MyCat"><a href="#MyCat" class="headerlink" title="MyCat"></a>MyCat</h3><h4 id="介绍-5"><a href="#介绍-5" class="headerlink" title="介绍"></a>介绍</h4><blockquote>
<p>MyCat是开源的，活跃的，基于java语言编写的MySQL数据库中间件。可以向使用MySQL一样来使用MyCat，对于开发人员来说根本感觉不到MyCat的存在。</p>
<p>优势：</p>
<ul>
<li>性能可靠稳定</li>
<li>强大的技术团队</li>
<li>体系完善</li>
<li>社区活跃</li>
</ul>
<p><strong>下载</strong></p>
<p><a target="_blank" rel="noopener" href="http://mycat.org.cn/">http://mycat.org.cn/</a></p>
<p><strong>目录结构</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722210711916.png" alt="image-20240722210711916"></p>
</blockquote>
<blockquote>
<p><strong>概念介绍</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722211113649.png" alt="image-20240722211113649"></p>
</blockquote>
<h4 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h4><blockquote>
<p>需求：由于tb_order表中数据量很大，磁盘IO及容量都到达率瓶颈，现在需要对tb_oreder表记性数据分片，分为三个数据节点，每一个节点主机位于不同的服务器上，具体结构如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722211421055.png" alt="image-20240722211421055"></p>
<p><strong>环境准备</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722211518387.png" alt="image-20240722211518387"></p>
<p><strong>分片配置(schema.xml)</strong></p>
<p>conf目录下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722211821071.png" alt="image-20240722211821071"></p>
<p><strong>server.xml</strong></p>
<p>配置MyCat的用户级用户的权限信息：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722215203390.png" alt="image-20240722215203390"></p>
<p><strong>启动服务</strong></p>
<p>切换到MyCat的安装目录，执行指令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动</span></span><br><span class="line">bin/mycat start</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停止</span></span><br><span class="line">bin/mycat stop</span><br></pre></td></tr></table></figure>

<p>启动后占用端口号为：8066</p>
<p>启动完毕之后，可以查看logs目录下的启动日志，查看MyCat是否启动完成</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240722215711677.png" alt="image-20240722215711677"></p>
<p><code>连接并登录MyCat</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h192.168.xx.xx -p端口号(8066) -uroot -p密码</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><blockquote>
<p><strong>schema.xml</strong></p>
<p>schema.xml作为MyCat的最重要的配置文件之一，涵盖了MyCat的逻辑库，逻辑表，分片规则，分片节点及数据源的配置。</p>
<p>主要包含以下三组标签：</p>
<ul>
<li>scheme标签</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723135237765.png" alt="image-20240723135237765"></p>
<p><code>schema标签</code>用于定义MyCat实例中的逻辑库，应该MyCat实例中，可以有多个逻辑库，可以通过schema标签来划分不同的逻辑库。MyCat中逻辑库的概念，等同于MySQL中database的概念，需要操作某个逻辑库下的表时，也需要切换逻辑库(use xxx)。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723135647862.png" alt="image-20240723135647862"></p>
<p><code>table标签</code>定义了MyCat中逻辑库schema下的逻辑表，所有需要拆分的表都需要的table标签中定义。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723135911840.png" alt="image-20240723135911840"></p>
<ul>
<li>dataNode标签</li>
</ul>
<p><code>dataNode标签</code>中定义了MyCat中的数据节点，也就是我们通常说的数据分片。一个dataNode标签就是一个独立的数据分片。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723140146686.png" alt="image-20240723140146686"></p>
<ul>
<li>dataHost标签</li>
</ul>
<p>该标签中MyCat逻辑库中作为底层标签存在，直接定义了具体的数据库实例，读写分离，心跳语句。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723140240383.png" alt="image-20240723140240383"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723140612273.png" alt="image-20240723140612273"></p>
<p><strong>rule.xml</strong></p>
<p>rule.xml中定义了所有拆分分表的规则，在使用过程中可以灵活的使用分片算法，或者对同一个分片算法使用不同的参数，它让分片过程可配置化。主要包含类标签：<code>tableRule，Function</code>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723140953784.png" alt="image-20240723140953784"></p>
<p><strong>server.xml</strong></p>
<p>server.xml配置文件包含了MyCat的系统配置信息，主要有两个主要的标签：system，user</p>
<p>system标签</p>
<p>user标签：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723144857429.png" alt="image-20240723144857429"></p>
</blockquote>
<h4 id="分片"><a href="#分片" class="headerlink" title="分片"></a>分片</h4><blockquote>
<p><strong>垂直拆分</strong></p>
<p>场景：在业务系统中，涉及以下表结构，但是由于用户与订单每天都会产生大量的数据，单台服务器的数据存储及处理能力是有限的，可以对数据库进行拆分，原有的数据库表如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723150058670.png" alt="image-20240723150058670"></p>
<p>准备：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723150224635.png"></p>
<p>配置：</p>
<p><code>schema.xml</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723150333645.png" alt="image-20240723150333645"></p>
<p><code>server.xml</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723150811847.png" alt="image-20240723150811847"></p>
<p>测试：</p>
<p>在MyCat的SQL语句等同于在MySQL的SQL语句。</p>
<p>全局表配置：</p>
<p>对于省市区表，是属于数据字典表，在多个业务模块中都可能会遇到，可以将其设置为全局表，利于业务操作。</p>
<p><code>schema.xml</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723152521202.png" alt="image-20240723152521202"></p>
</blockquote>
<blockquote>
<p><strong>水平拆分</strong></p>
<p>场景：在业务系统中，有一张表(日志表),业务系统每天都会产生大量的日志数据，单台服务器的数据存储及处理能力是有限的，可以对数据库表进行拆分。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723153244116.png" alt="image-20240723153244116"></p>
<p>准备：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723153322446.png" alt="image-20240723153322446"></p>
<p>配置：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723153414322.png" alt="image-20240723153414322"></p>
<p>测试：</p>
<p>在MyCat的命令行中，执行如下SQL创建表，并插入数据，查看数据分布情况。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723154143522.png" alt="image-20240723154143522"></p>
</blockquote>
<h4 id="分片规则"><a href="#分片规则" class="headerlink" title="分片规则"></a>分片规则</h4><blockquote>
<p><strong>范围分片</strong></p>
<p>根据指定的字段及其配置的范围与数据节点的对应情况，来决定该数据属于哪一个分片。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723155112770.png" alt="image-20240723155112770"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723155221303.png" alt="image-20240723155221303"></p>
<p>需要自定义时，修改<code>xxx.txt</code>文件的规则即可。</p>
<p><strong>取模分片</strong></p>
<p>根据指定的字段与节点数量进行求模运算，根据运算结果，来决定该数据属于哪一个分片。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723155427167.png" alt="image-20240723155427167"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723155506700.png" alt="image-20240723155506700"></p>
<p><strong>一致性Hash</strong></p>
<p>一致性哈希:相同的哈希因子计算值总是被划分到相同分区表中，不会业务分区节点的增加而改变原来的数据的分区位置。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723155813171.png" alt="image-20240723155813171"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723155831191.png" alt="image-20240723155831191"></p>
<p><strong>枚举分片</strong></p>
<p>通过在配置文件中配置可能的枚举值，指定数据分布到不同数据节点上，本规则适用于按照省份，性别，状态拆分数据等业务。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723160511128.png" alt="image-20240723160511128"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723160532249.png" alt="image-20240723160532249"></p>
<p><strong>应用指定分片</strong></p>
<p>运行阶段由应用自主决定路由到那个分片，直接更具字符子串(必须是数字)计算分片号。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723161806903.png" alt="image-20240723161806903"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723161826554.png" alt="image-20240723161826554"></p>
<p><strong>固定分片Hash算法</strong></p>
<p>该算法类似于十进制的求模运算，但是为二级制的操作，例如，取id的二进制低10位与1111111111进行位&amp;运算。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723163222803.png" alt="image-20240723163222803"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723164724547.png"></p>
<p><strong>字符串Hash解析</strong></p>
<p>截取字符串中的指定位置的子字符串，进行Hash算法，算出分片。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723165437500.png" alt="image-20240723165437500"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723165810603.png"></p>
<p><strong>按天日期分片</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723205240119.png" alt="image-20240723205240119"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723205512629.png"></p>
<p><strong>按自然月分片</strong></p>
<p>使用场景为按照月份来分片，每个自然月为一个分片。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723210821970.png" alt="image-20240723210821970"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723210931094.png" alt="image-20240723210931094"></p>
</blockquote>
<h4 id="MyCat管理"><a href="#MyCat管理" class="headerlink" title="MyCat管理"></a>MyCat管理</h4><blockquote>
<p>MyCat原理：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723212714520.png" alt="image-20240723212714520"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723213118786.png" alt="image-20240723213118786"></p>
</blockquote>
<blockquote>
<p>MyCat默认卡通2个端口，可以在server.xml中进行修改</p>
<ul>
<li>8066数据访问端口，即进行DML和DDL操作。</li>
<li>9066数据库管理端口，即MyCat服务管理控制功能，用于管理MyCat的整个集群状态。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>h <span class="number">192.168</span><span class="number">.200</span><span class="number">.210</span> <span class="operator">-</span>p <span class="number">9066</span> <span class="operator">-</span>uroot <span class="operator">-</span>p123456</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723213430498.png" alt="image-20240723213430498"></p>
</blockquote>
<h4 id="MyCat监控"><a href="#MyCat监控" class="headerlink" title="MyCat监控"></a>MyCat监控</h4><blockquote>
<p><strong>MyCat-eye</strong></p>
<p>MyCat-web(MyCat-eye)是对MyCat-server提供监控服务，功能不局限于对MyCat-server使用。它通过JDBC连接对MyCat，MySQL监控，监控远程服务器(目前仅限于Linux系统的)CPU，内存，网络，磁盘。</p>
<p>MyCat-eye运行过程中需要依赖zookeeper，因此需要先安装zookeeper。</p>
<p><strong>安装</strong></p>
<ul>
<li><p>zookeeper安装</p>
</li>
<li><p>MyCat-eye安装</p>
</li>
</ul>
<p><strong>配置</strong></p>
<ul>
<li>开启MyCat的实时统计功能(server.xml)</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 1为开启，0关闭</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userSqlStat&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在MyCat监控界面配置服务地址</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723220123636.png" alt="image-20240723220123636"></p>
</blockquote>
<h2 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h2><h3 id="介绍-6"><a href="#介绍-6" class="headerlink" title="介绍"></a>介绍</h3><blockquote>
<p>读写分离，简单地说是把对数据库的读和写操作分开，以对应不同的数据库服务器。主数据库提供写操作，从数据库提供读操作，这样能有效地减轻单台数据库的压力。</p>
<p>通过MyCat即可实现上述功能，不仅可以支持MySQL，也可以支持oracle和SQL server。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240723221812247.png" alt="image-20240723221812247"></p>
</blockquote>
<h3 id="一主一从读写分离"><a href="#一主一从读写分离" class="headerlink" title="一主一从读写分离"></a>一主一从读写分离</h3><blockquote>
<p><strong>配置</strong></p>
<p>MyCat控制后台数据库的读写分离和负载均衡有schema.xml文件dataHost标签的balance属性控制。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240724143239899.png" alt="image-20240724143239899"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240724143634451.png" alt="image-20240724143634451"></p>
<p><code>存在的问题</code>：主节点Master主库宕机之后，业务系统就只能够读，而不能写入数据了,为了高可用，创建双主双从读写分离的数据库。</p>
</blockquote>
<h3 id="双主双从"><a href="#双主双从" class="headerlink" title="双主双从"></a>双主双从</h3><blockquote>
<p><strong>介绍</strong></p>
<p>一个主机Master1用于处理所有写请求，它的从机slave1和另一台主机Master2还有他的从机slave2负责所有读请求。当Master1主机宕机后，Master2主机否则写请求，Master1，Master2互为备机。架构图如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240724145549638.png" alt="image-20240724145549638"></p>
<p><strong>准备</strong></p>
<p>我们需要准备5台服务器，具体的服务器及软件安装情况如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240724145647478.png" alt="image-20240724145647478"></p>
<p><strong>搭建</strong></p>
<p>主库1配置：</p>
<ol>
<li>修改配置文件：&#x2F;etc&#x2F;my.cnf</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240724150042094.png" alt="image-20240724150042094"></p>
<ol start="2">
<li>重启MySQL服务器</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure>

<p>主库2配置：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240724150348274.png" alt="image-20240724150348274"></p>
<p>两台主库创建账号并授权(两台主库操作相同)：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240724150519131.png" alt="image-20240724150519131"></p>
<p>从库1配置：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240724150812209.png" alt="image-20240724150812209"></p>
<p>从库2配置：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240724150900634.png" alt="image-20240724150900634"></p>
<p>两台从库配置关联的主库：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240724150944492.png" alt="image-20240724150944492"></p>
<p>两台主库相互复制：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240724151520154.png" alt="image-20240724151520154"></p>
</blockquote>
<h3 id="双主双从读写分离"><a href="#双主双从读写分离" class="headerlink" title="双主双从读写分离"></a>双主双从读写分离</h3><blockquote>
<p><strong>配置</strong></p>
<p>MyCat控制后台数据库的读写分离和负载均衡有schema.xml文件datahost标签的balance属性控制，通过writeType及switchType来完成失败自动切换的。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240724152144066.png" alt="image-20240724152144066"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/image-20240724152506951.png" alt="image-20240724152506951"></p>
<p><strong>测试</strong></p>
<p>登录MyCat，测试查询机更新操作，判定是否能够进行读写分离，以及读写分离的策略是否正确。</p>
<p>当主库挂掉一个之后，是否能够自动切换。</p>
</blockquote>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/1711095406-u1644142392678189819fm253fmtautoapp138fJPEG%20(1).webp" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/1711095406-u1644142392678189819fm253fmtautoapp138fJPEG%20(1).webp" title="头像" alt="头像"></a><div class="post-copyright__author_name">Huang_Chun</div><div class="post-copyright__author_desc">编程之路...</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://www.dachun.icu/2024/05/09/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://www.dachun.icu/2024/05/09/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87/')">MySQL笔记</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null"/></a><div class="post-qr-code-desc"></div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null"/></a><div class="post-qr-code-desc"></div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://www.dachun.icu/2024/05/09/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=MySQL笔记&amp;url=https://www.dachun.icu/2024/05/09/MySQL%E5%9F%BA%E7%A1%80%E7%AF%87/&amp;pic=https://chunimages.oss-cn-guangzhou.aliyuncs.com/9d742708167ba170dd0f5999451e0060.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.dachun.icu" target="_blank">ifChun</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="categoryes-punctuation"> <i class="anzhiyufont anzhiyu-icon-inbox"></i></span>数据库<span class="categoryesPageCount">4</span></a></div><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/MySQL/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>MySQL<span class="tagsPageCount">1</span></a></div></div><div class="post_share"><div class="social-share" data-image="https://chunimages.oss-cn-guangzhou.aliyuncs.com/cd19206997268909f60592f942c9d560.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/05/09/redis%E5%9F%BA%E7%A1%80%E7%AF%87/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://pic1.zhimg.com/v2-68ba5c63fb878f074c4ac91e944b24a4_1440w.jpg?source=172ae18b" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">redis基础篇</div></div></a></div><div class="next-post pull-right"><a href="/2024/05/09/SQLserver%E5%9F%BA%E7%A1%80%E7%AF%87/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/e68192338c9fc0a8b09180d0453c6389.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">SQLserver基础篇</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/1711095406-u1644142392678189819fm253fmtautoapp138fJPEG%20(1).webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description">悟已往之不谏，知来者之可追。</div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(null) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%AA%97%E5%8F%A3%E8%BF%9E%E6%8E%A5MySQL%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.1.</span> <span class="toc-text">用命令行窗口连接MySQL数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%8C%87%E4%BB%A4%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.2.</span> <span class="toc-text">使用指令创建数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D%E6%93%8D%E4%BD%9C"><span class="toc-number">1.3.</span> <span class="toc-text">数据库备份恢复操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.</span> <span class="toc-text">数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">1.5.</span> <span class="toc-text">表操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8where%E5%AD%90%E5%8F%A5%E4%B8%AD%E7%BB%8F%E5%B8%B8%E4%BD%BF%E7%94%A8%E7%9A%84%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.6.</span> <span class="toc-text">在where子句中经常使用的运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.7.</span> <span class="toc-text">字符串数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="toc-number">1.8.</span> <span class="toc-text">时间日期相关函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="toc-number">1.9.</span> <span class="toc-text">数学相关函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E5%92%8C%E7%B3%BB%E7%BB%9F%E5%87%BD%E6%95%B0"><span class="toc-number">1.10.</span> <span class="toc-text">加密和系统函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%87%BD%E6%95%B0"><span class="toc-number">1.11.</span> <span class="toc-text">流程控制函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.12.</span> <span class="toc-text">分页查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.13.</span> <span class="toc-text">连接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.13.1.</span> <span class="toc-text">自连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A6%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.13.2.</span> <span class="toc-text">左外连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%B3%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.13.3.</span> <span class="toc-text">右外连接</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.14.</span> <span class="toc-text">约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">2.</span> <span class="toc-text">事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7%EF%BC%88ACID%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">事务的四大特性（ACID）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%98"><span class="toc-number">2.2.</span> <span class="toc-text">并发事务问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-number">2.3.</span> <span class="toc-text">事务隔离级别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="toc-number">3.</span> <span class="toc-text">存储引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E7%89%B9%E7%82%B9"><span class="toc-number">3.1.</span> <span class="toc-text">存储引擎特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E9%80%89%E6%8B%A9"><span class="toc-number">3.2.</span> <span class="toc-text">存储引擎选择</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">4.</span> <span class="toc-text">索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%A6%82%E8%BF%B0"><span class="toc-number">4.1.</span> <span class="toc-text">索引概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84"><span class="toc-number">4.2.</span> <span class="toc-text">索引结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%88%86%E7%B1%BB"><span class="toc-number">4.3.</span> <span class="toc-text">索引分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E8%AF%AD%E6%B3%95"><span class="toc-number">4.4.</span> <span class="toc-text">索引语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="toc-number">4.5.</span> <span class="toc-text">SQL性能分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%88%99"><span class="toc-number">4.6.</span> <span class="toc-text">索引使用原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">4.7.</span> <span class="toc-text">索引设计原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL%E4%BC%98%E5%8C%96"><span class="toc-number">5.</span> <span class="toc-text">SQL优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E4%BC%98%E5%8C%96"><span class="toc-number">5.1.</span> <span class="toc-text">插入数据优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#insert%E4%BC%98%E5%8C%96"><span class="toc-number">5.1.1.</span> <span class="toc-text">insert优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%A7%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">5.1.2.</span> <span class="toc-text">大批量插入数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E4%BC%98%E5%8C%96"><span class="toc-number">5.2.</span> <span class="toc-text">主键优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#order-by-%E4%BC%98%E5%8C%96"><span class="toc-number">5.3.</span> <span class="toc-text">order by 优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#group-by%E4%BC%98%E5%8C%96"><span class="toc-number">5.4.</span> <span class="toc-text">group by优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#limit-%E4%BC%98%E5%8C%96"><span class="toc-number">5.5.</span> <span class="toc-text">limit 优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#count-%E4%BC%98%E5%8C%96"><span class="toc-number">5.6.</span> <span class="toc-text">count 优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#update%E4%BC%98%E5%8C%96"><span class="toc-number">5.7.</span> <span class="toc-text">update优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">6.</span> <span class="toc-text">视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E9%80%89%E9%A1%B9"><span class="toc-number">6.2.</span> <span class="toc-text">检查选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%9A%84%E6%9B%B4%E6%96%B0"><span class="toc-number">6.3.</span> <span class="toc-text">视图的更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">6.4.</span> <span class="toc-text">视图的作用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">7.</span> <span class="toc-text">存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">7.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">7.2.</span> <span class="toc-text">基本语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%87%8F"><span class="toc-number">7.3.</span> <span class="toc-text">变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5"><span class="toc-number">7.4.</span> <span class="toc-text">流程控制语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-number">7.5.</span> <span class="toc-text">存储函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">8.</span> <span class="toc-text">触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="toc-number">8.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">8.2.</span> <span class="toc-text">语法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%81"><span class="toc-number">9.</span> <span class="toc-text">锁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-3"><span class="toc-number">9.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E9%94%81"><span class="toc-number">9.2.</span> <span class="toc-text">全局锁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%BA%A7%E9%94%81"><span class="toc-number">9.3.</span> <span class="toc-text">表级锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E9%94%81"><span class="toc-number">9.3.1.</span> <span class="toc-text">表锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE%E9%94%81-meta-data-lock%EF%BC%8CMDL"><span class="toc-number">9.3.2.</span> <span class="toc-text">元数据锁(meta data lock，MDL)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%84%8F%E5%90%91%E9%94%81"><span class="toc-number">9.3.3.</span> <span class="toc-text">意向锁</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E7%BA%A7%E9%94%81"><span class="toc-number">9.4.</span> <span class="toc-text">行级锁</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%8C%E9%94%81"><span class="toc-number">9.4.1.</span> <span class="toc-text">行锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%B4%E9%9A%99%E9%94%81-%E4%B8%B4%E9%94%AE%E9%94%81"><span class="toc-number">9.4.2.</span> <span class="toc-text">间隙锁&#x2F;临键锁</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#InnoDB%E5%BC%95%E6%93%8E"><span class="toc-number">10.</span> <span class="toc-text">InnoDB引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="toc-number">10.1.</span> <span class="toc-text">逻辑存储结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84"><span class="toc-number">10.2.</span> <span class="toc-text">架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%8E%9F%E7%90%86"><span class="toc-number">10.3.</span> <span class="toc-text">事务原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MVCC"><span class="toc-number">10.4.</span> <span class="toc-text">MVCC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">10.4.1.</span> <span class="toc-text">实现原理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E7%AE%A1%E7%90%86"><span class="toc-number">11.</span> <span class="toc-text">MySQL管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">11.1.</span> <span class="toc-text">系统数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">11.2.</span> <span class="toc-text">常用工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97"><span class="toc-number">12.</span> <span class="toc-text">日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97"><span class="toc-number">12.1.</span> <span class="toc-text">错误日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E5%88%B6%E6%97%A5%E5%BF%97"><span class="toc-number">12.2.</span> <span class="toc-text">二级制日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">12.3.</span> <span class="toc-text">查询日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="toc-number">12.4.</span> <span class="toc-text">慢查询日志</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">13.</span> <span class="toc-text">主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">13.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">13.2.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA"><span class="toc-number">13.3.</span> <span class="toc-text">搭建</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8"><span class="toc-number">14.</span> <span class="toc-text">分库分表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-4"><span class="toc-number">14.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%86%E5%88%86%E7%AD%96%E7%95%A5"><span class="toc-number">14.2.</span> <span class="toc-text">拆分策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyCat"><span class="toc-number">14.3.</span> <span class="toc-text">MyCat</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-5"><span class="toc-number">14.3.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A5%E9%97%A8"><span class="toc-number">14.3.2.</span> <span class="toc-text">入门</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">14.3.3.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%89%87"><span class="toc-number">14.3.4.</span> <span class="toc-text">分片</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%89%87%E8%A7%84%E5%88%99"><span class="toc-number">14.3.5.</span> <span class="toc-text">分片规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MyCat%E7%AE%A1%E7%90%86"><span class="toc-number">14.3.6.</span> <span class="toc-text">MyCat管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MyCat%E7%9B%91%E6%8E%A7"><span class="toc-number">14.3.7.</span> <span class="toc-text">MyCat监控</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-number">15.</span> <span class="toc-text">读写分离</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-6"><span class="toc-number">15.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%BB%E4%B8%80%E4%BB%8E%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-number">15.2.</span> <span class="toc-text">一主一从读写分离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E4%B8%BB%E5%8F%8C%E4%BB%8E"><span class="toc-number">15.3.</span> <span class="toc-text">双主双从</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E4%B8%BB%E5%8F%8C%E4%BB%8E%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-number">15.4.</span> <span class="toc-text">双主双从读写分离</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/08/28/react/" title="react"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/cd19206997268909f60592f942c9d560.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="react"/></a><div class="content"><a class="title" href="/2024/08/28/react/" title="react">react</a><time datetime="2024-08-28T14:50:56.000Z" title="发表于 2024-08-28 22:50:56">2024-08-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/09/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" title="操作系统"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/f285d69b18260b1a42947e8e4c4a80e3.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="操作系统"/></a><div class="content"><a class="title" href="/2024/07/09/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" title="操作系统">操作系统</a><time datetime="2024-07-09T12:56:32.000Z" title="发表于 2024-07-09 20:56:32">2024-07-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/06/Electron%E5%9F%BA%E7%A1%80%E7%AF%87/" title="Electron基础篇"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/de089aeaa9e04600bfebcc53d6ccb8cb.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Electron基础篇"/></a><div class="content"><a class="title" href="/2024/07/06/Electron%E5%9F%BA%E7%A1%80%E7%AF%87/" title="Electron基础篇">Electron基础篇</a><time datetime="2024-07-06T09:37:59.000Z" title="发表于 2024-07-06 17:37:59">2024-07-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/22/uni-app%E5%9F%BA%E7%A1%80%E7%AF%87/" title="uni-app基础篇"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://chunimages.oss-cn-guangzhou.aliyuncs.com/cb632b7da63e7b51224bc1f17eb50f15.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="uni-app基础篇"/></a><div class="content"><a class="title" href="/2024/06/22/uni-app%E5%9F%BA%E7%A1%80%E7%AF%87/" title="uni-app基础篇">uni-app基础篇</a><time datetime="2024-06-22T14:39:59.000Z" title="发表于 2024-06-22 22:39:59">2024-06-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/10/20240610/" title="20240610"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="20240610"/></a><div class="content"><a class="title" href="/2024/06/10/20240610/" title="20240610">20240610</a><time datetime="2024-06-10T14:13:39.000Z" title="发表于 2024-06-10 22:13:39">2024-06-10</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="Huang_Chun" target="_blank">Huang_Chun</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">46</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">32</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">9</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/beginner-Chun" title="GitHub"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="GitHub"/><span class="back-menu-item-text">GitHub</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://gitee.com/beginner-chun" title="Gitee"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="Gitee"/><span class="back-menu-item-text">Gitee</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=1708664797&amp;server=tencent"><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size: 0.9em;"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 箴言</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Ajax/" style="font-size: 0.88rem;">Ajax<sup>1</sup></a><a href="/tags/CSS/" style="font-size: 0.88rem;">CSS<sup>1</sup></a><a href="/tags/ES/" style="font-size: 0.88rem;">ES<sup>2</sup></a><a href="/tags/Electron/" style="font-size: 0.88rem;">Electron<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem;">JavaScript<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>1</sup></a><a href="/tags/MarkDown/" style="font-size: 0.88rem;">MarkDown<sup>1</sup></a><a href="/tags/MySQL/" style="font-size: 0.88rem;">MySQL<sup>1</sup></a><a href="/tags/Mybatis/" style="font-size: 0.88rem;">Mybatis<sup>1</sup></a><a href="/tags/Mybatis-Plus/" style="font-size: 0.88rem;">Mybatis-Plus<sup>1</sup></a><a href="/tags/RabbitMQ/" style="font-size: 0.88rem;">RabbitMQ<sup>2</sup></a><a href="/tags/SQLserver/" style="font-size: 0.88rem;">SQLserver<sup>1</sup></a><a href="/tags/SSM/" style="font-size: 0.88rem;">SSM<sup>1</sup></a><a href="/tags/SpringAi/" style="font-size: 0.88rem;">SpringAi<sup>1</sup></a><a href="/tags/SpringBoot/" style="font-size: 0.88rem;">SpringBoot<sup>1</sup></a><a href="/tags/SpringCloud/" style="font-size: 0.88rem;">SpringCloud<sup>1</sup></a><a href="/tags/SpringSecurity/" style="font-size: 0.88rem;">SpringSecurity<sup>1</sup></a><a href="/tags/TypeScript/" style="font-size: 0.88rem;">TypeScript<sup>1</sup></a><a href="/tags/docker-%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 0.88rem;">docker, 微服务<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/html/" style="font-size: 0.88rem;">html<sup>1</sup></a><a href="/tags/react/" style="font-size: 0.88rem;">react<sup>1</sup></a><a href="/tags/redis/" style="font-size: 0.88rem;">redis<sup>2</sup></a><a href="/tags/uniapp/" style="font-size: 0.88rem;">uniapp<sup>2</sup></a><a href="/tags/vue/" style="font-size: 0.88rem;">vue<sup>2</sup></a><a href="/tags/webpack/" style="font-size: 0.88rem;">webpack<sup>1</sup></a><a href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 0.88rem;">微信小程序<sup>2</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 0.88rem;">操作系统<sup>1</sup></a><a href="/tags/%E6%96%87%E8%A8%80%E6%96%87/" style="font-size: 0.88rem;">文言文<sup>1</sup></a><a href="/tags/%E6%97%A5%E5%BF%97/" style="font-size: 0.88rem;">日志<sup>11</sup></a><a href="/tags/%E7%95%99%E5%80%99%E4%BC%A0/" style="font-size: 0.88rem;">留候传<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" style="font-size: 0.88rem;">计算机组成原理<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8671306203&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("2024年5月2日"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Huang_Chun 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script id="click-heart" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>